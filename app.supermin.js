(()=>{var vt=Object.defineProperty,bt=Object.defineProperties;var kt=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var Ct=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable;var et=(a,t,e)=>t in a?vt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,p=(a,t)=>{for(var e in t||(t={}))Ct.call(t,e)&&et(a,e,t[e]);if(at)for(var e of at(t))Et.call(t,e)&&et(a,e,t[e]);return a},C=(a,t)=>bt(a,kt(t));var v=(a,t,e)=>(et(a,typeof t!="symbol"?t+"":t,e),e),it=(a,t,e)=>{if(!t.has(a))throw TypeError("Cannot "+e)};var m=(a,t,e)=>(it(a,t,"read from private field"),e?e.call(a):t.get(a)),D=(a,t,e)=>{if(t.has(a))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(a):t.set(a,e)},st=(a,t,e,i)=>(it(a,t,"write to private field"),i?i.call(a,e):t.set(a,e),e);var J=(a,t,e)=>(it(a,t,"access private method"),e);var $=class{constructor(t={}){this.o=!1,this.v=window.v,this.C=t.C,this.le=new URL(this.C.endpoint).origin,this.lt={},this.ht={admin:{drag:!0,view:!0},developer:{drag:!0,view:!0},client:{drag:!0,view:!0},guest:{drag:!1,view:!0}},this.s={le:this.le,n:"init",c:null,E:null,Q:null,h:null,tt:null,U:null,Y:null},this.o,this.loadState()}on(t,e){return this.lt[t]||(this.lt[t]=[]),this.lt[t].push(e),this}off(t,e){return this.lt[t]?(this.lt[t]=this.lt[t].filter(i=>i!==e),this):this}emit(t,e){this.lt[t]&&this.lt[t].forEach(i=>i(e))}get n(){return this.s.n}set n(t){let e=this.s.n;this.s.n=t,this.o,this.emit("state-change",{property:"state",oldValue:e,newValue:t})}get c(){return this.s.c?this.s.c:!1}set c(t){let e=this.s.c;this.s.c=t,this.o,this.emit("state-change",{property:"user",oldValue:e,newValue:t}),window.kt.setAuthToken(t.token),this.saveState()}get E(){return this.s.E?this.s.E:!1}set E(t){let e=this.s.E;t.total>0&&(this.s.E=t.properties.project,this.s.tt=t.properties.member),this.o,this.emit("state-change",{property:"project",oldValue:e,newValue:t}),this.saveState()}get Q(){return this.s.Q}set Q(t){let e=this.s.Q;this.s.Q=t,this.o,this.emit("state-change",{property:"projectList",oldValue:e,newValue:t}),this.saveState()}get h(){return this.s.h===null||this.s.h===!1?[]:this.s.h.map(e=>{let i=this.v.ii(e.href),s=this.v.ii(window.location.href);return e.page=i,i==="index"&&s==="index"||i===s?e.isSamePage=!0:e.isSamePage=!1,e})}set h(t=[]){this.s.h=t,this.o,this.emit("state-change",{property:"tasks",oldValue:null,newValue:t}),this.saveState()}set ss(t){window.k.rs(t),this.s.h?this.s.h.push(t):this.s.h=[t],this.o,this.emit("state-change",{property:"tasks",oldValue:null,newValue:t}),this.saveState()}set et(t){let e=this.s.h.find(s=>s.id===t.id),i=this.s.h.findIndex(s=>s.id===t.id);this.s.h[i]=t,this.o,this.emit("state-change",{property:"tasks",oldValue:e,newValue:t}),this.saveState()}set Ot(t){let e=this.s.h.find(i=>i.id===t);this.s.h=this.s.h.filter(i=>i.id!==t),this.o,this.emit("state-change",{property:"tasks",oldValue:e,newValue:null}),this.saveState()}get tt(){return this.s.tt}set tt(t){this.s.tt=t,this.o,this.emit("state-change",{property:"assignees",oldValue:null,newValue:t})}get U(){return this.s.U}set U(t){this.s.U=t,this.o,this.emit("state-change",{property:"priority",oldValue:null,newValue:t}),this.saveState()}get Y(){return this.s.Y}set Y(t){this.s.Y=t,this.o,this.emit("state-change",{property:"status",oldValue:null,newValue:t}),this.saveState()}saveState(){try{let t={user:this.s.c?JSON.parse(JSON.stringify(this.s.c)):null,project:this.s.E?JSON.parse(JSON.stringify(this.s.E)):null,projectList:this.s.Q?JSON.parse(JSON.stringify(this.s.Q)):null,tasks:this.s.h?JSON.parse(JSON.stringify(this.s.h)):null,assignees:this.s.tt?JSON.parse(JSON.stringify(this.s.tt)):null,priority:this.s.U?JSON.parse(JSON.stringify(this.s.U)):null,status:this.s.Y?JSON.parse(JSON.stringify(this.s.Y)):null};return localStorage.setItem("flagbug_state",JSON.stringify(t)),this.o,!0}catch(t){return!1}}loadState(){try{let t=localStorage.getItem("flagbug_state");if(!t)return this.o,!1;let e=JSON.parse(t);return this.o,e.user&&(this.s.c=e.user),e.project&&(this.s.E=e.project),e.projectList&&(this.s.Q=e.projectList),e.tasks&&(this.s.h=e.tasks),e.assignees&&(this.s.tt=e.assignees),e.priority&&(this.s.U=e.priority),e.status&&(this.s.Y=e.status),this.o,this.emit("state-loaded",this.s),!0}catch(t){return!1}}clearState(){this.s={origin:this.le,state:"init",user:null,project:null,projectList:null,tasks:null,assignees:null,priority:null,status:null},localStorage.removeItem("flagbug_state"),this.o,this.emit("state-cleared")}getUserPermissions(t=null){let e=this.ht[this.c.role],i=this.c.role;if(t==null)return{isPermission:e,role:i};if(typeof t=="object"&&t.hasOwnProperty("created_by")){let s=this.c.id===t.created_by;return{isPermission:e,isSameUser:s,role:i}}else{t=this.getTaskById(t);let s=this.c.id===t.created_by;return{isPermission:e,isSameUser:s,role:i}}}};var M=class{constructor(t={}){this.ns="1.0",this.n=t.n,this.C=t.C,this.as=this.C.endpoint,this.he=this.n.c?this.n.c.token:null,this.v=window.v,this.H={ls:"task",si:"task/",hs:"task/",lr:"task/",cs:"project?domain=",ds:"user/login",us:"task/",fs:"task",gs:"capture",ps:"task/by-project/"},this.init(),this.he&&this.oi()}async init(){}ce(t,e){return!(e.filter(s=>!t.hasOwnProperty(s)).length>0)}setAuthToken(t){this.he=t}async it(t,e,i=null,s=null){let o=`${this.as}${t}`;if(s){let h=new URLSearchParams(s);o+=`?${h.toString()}`}let r={method:e,headers:{"Content-Type":"application/json"}};this.he&&(r.headers.Authorization=`Bearer ${this.he}`),i&&(i instanceof FormData?(r.body=i,delete r.headers["Content-Type"]):r.body=JSON.stringify(i));let n=await fetch(o,r);if(!n.ok){let h=await n.json();if(h.error)return window.w.create({title:"Error",description:h.error,type:"error"}),!1;h.details&&h.details.length>0&&h.details.forEach(c=>{window.w.create({title:"Error",description:c.message,type:"error"})}),this.o}n.ok;let l=n.headers.get("content-type");return l&&l.includes("application/json")?n.json():n.text()}async ri({domain:t=window.location.hostname}){if(!t)return;let e=await this.it(this.H.cs+t,"GET");return e.total>0?window.p.E=e:window.p.E=!1,e}async ms({payload:t=null}){window.p.clearState();let e=["email","password"];if(!this.ce(t,e))return;let i=await this.it(this.H.ds,"POST",t);if(window.p.c=i,i&&i.token){this.setAuthToken(i.token),window.p.c=i,this.oi(),window.L.init();let s=await this.ri({domain:window.location.hostname});s.total>0&&await this.ws({project_id:s.properties.project.project_id})}return i}async ys({payload:t=null}){let e=["project_id","created_by","assigned_to","title","description","status","priority","due_date"];if(!this.ce(t,e))return;let i=null;if(t.mode==="screenshot"){let n=document.querySelector("#FlagBugIO__screenshot_canvas").toDataURL("image/jpeg",1);i=await(await fetch(n)).blob()}let s=new FormData;s.append("payload",JSON.stringify(t)),i&&s.append("screenshot",i,"screenshot.jpg");let o=await this.it(this.H.ls,"POST",s);return o.id?o:!1}async et({id:t=null,payload:e=null}){if(!t||!e)return;let{isSameUser:i,role:s}=window.p.getUserPermissions(e),o=`${this.H.si}${t}`;!i&&s==="developer"&&(o=`${this.H.si}${t}/update`);let r=await this.it(`${o}`,"PATCH",e);return r.id,r}async Ot({id:t=null}){if(!t)return;let e=await this.it(`${this.H.us}${t}`,"DELETE");return e&&(window.p.Ot=t),e}async vs({payload:t=null}){let e=["id","mouseX","mouseY"];if(!this.ce(t,e))return;let i=t.id;delete t.id;let s=await this.it(`${this.H.hs}${i}/position`,"PATCH",t);return s.id&&(window.p.et=s.properties),s}async ws({project_id:t=null}){if(!t)return;let e=await this.it(`${this.H.fs}/by-project/${t}`,"GET",null);return e&&e.total>0?(window.p.h=e.properties,e.properties):(window.p.h=[],[])}async bs({payload:t=null}){let e=["href","width","height","scrollX","scrollY","pixelRatio"];if(this.ce(t,e))return this.it(this.H.gs,"POST",t)}async hr({user_id:t=null}){if(!t)return;let e=await this.it(this.H.ps+t,"GET");return window.p.Q=e.properties,e}oi(){window.p.U=[{value:"very-low",label:"Very Low"},{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],window.p.Y=[{value:"new",label:"New"},{value:"open",label:"Open"},{value:"progress",label:"In Progress"},{value:"completed",label:"Done"},{value:"resolved",label:"Resolved"},{value:"archived",label:"Archived"}]}};var b=class{constructor(){this.ks=["title","description","due_date","assigned_to","priority","status","submit","cancel"]}Fragment(t){return document.createRange().createContextualFragment(t)}create({tag:t="div",id:e="",className:i="",inner:s="",isDraggable:o=!1,attributes:r={}}){let n=document.createElement(t);e&&(n.id=e),i&&(n.className=i),s&&t!=="input"&&(typeof s=="string"||typeof s=="number"?(n.innerHTML=s,n.setAttribute("value",s)):s instanceof Node&&(n.innerHTML="",n.appendChild(s))),s&&t==="input"&&(n.value=s),o&&n.setAttribute("data-no-drag","true");for(let[l,h]of Object.entries(r))n.setAttribute(l,h),l==="contenteditable"&&h&&n.removeAttribute("disabled"),l==="contenteditable"&&!h&&n.setAttribute("disabled","true"),this.ks.forEach(c=>{h===c&&n.setAttribute("tabindex",0)});return n}createTree(t){let{tag:e="div",id:i="",className:s="",inner:o="",isDraggable:r=!1,attributes:n={},children:l=[]}=t,h=this.create({tag:e,id:i,className:s,inner:o,isDraggable:r,attributes:n});for(let c of l){let d=this.createTree(c);h.appendChild(d)}return h}style(t,e){for(let[i,s]of Object.entries(e))t.style[i]=s}addClass(t,e,i=!1){i?document.querySelectorAll(t).forEach(o=>o.classList.add(e)):e.split(" ").forEach(o=>{t.classList.add(o)})}removeClass(t,e){t.classList.contains(e)&&t.classList.remove(e)}get(t,e=document){return e?e.querySelectorAll(t):document.querySelectorAll(t)}Cs(t){return t==null||t==="null"||t==="undefined"||isNaN(t)&&typeof t!="string"?null:String(t)}cr(t){let e={};return t.querySelectorAll("[name]").forEach(s=>{let o=this.Cs(s.value||s.getAttribute("value")||null);e[s.getAttribute("name")]=o}),e}getOne(t,e=document){return e?e.querySelector(t):document.querySelector(t)}setAttr(t,e,i){t.setAttribute(e,i)}getAttr(t,e){return t.getAttribute(e)}append(t,e){return Array.isArray(e)?e.forEach(i=>{t.appendChild(i)}):t.appendChild(e),t}remove(t,e){t.removeChild(e)}on(t,e,i){t.addEventListener(e,i)}off(t,e,i){t.removeEventListener(e,i)}};var E=class{constructor(t=window.location.href){this.Ct=new URL(t)}Es(t=window.location.href){return["mkr","page","priority","status"].forEach(i=>{this.Et(i)}),this.st()}ii(t=window.location.href){return new URL(t).pathname.split("/").pop().split(".")[0]||"index"}Ss(t=window.location.href){let e=new URL(t),i={};return e.searchParams.forEach((s,o)=>{i[o]=s}),{hostname:e.hostname,pathname:e.pathname,search:e.search,hash:e.hash,query:i}}X(t,e,i=!1){return i&&(this.Ct=new URL(window.location.href)),this.Ct.searchParams.set(t,e),i&&window.history.pushState({},"",this.st(),!0),this}Et(t,e=!1){return e&&(this.Ct=new URL(window.location.href)),this.Ct.searchParams.delete(t),e&&window.history.pushState({},"",this.st(),!0),this}ni(t){return this.Ct.searchParams.has(t)}Ht(t){return this.Ct.searchParams.get(t)}st(){return this.Ct.toString()}get k(){return this.Ht("mkr")}set k(t){this.X("mkr",t,!0)}get xs(){return this.Ht("page")}set xs(t){this.X("page",t)}get U(){return this.Ht("priority")}set U(t){this.X("priority",t)}get Y(){return this.Ht("status")}set Y(t){this.X("status",t)}De(t=!0){return this.Et("mkr",t)}dr(t=!0){return this.Et("page",t)}ur(t=!0){return this.Et("priority",t)}fr(t=!0){return this.Et("status",t)}};var y=class y{constructor({element:t,data:e,type:i="single",placeholder:s="Select",searchable:o=!1,key:r="label",value:n="value",style:l=null,isClearable:h=!1,permissions:c=!0,prefetch:d=null}){this.ct=t,this.l=t,this.dt=document.createElement("div"),this.dt.className="fg-input",this.l.parentNode.insertBefore(this.dt,this.l.nextSibling),this.l=this.dt,this.Ds=r,this._s=n,this.s=e?this.Ls(e):[],this.A=i,this._e=s,this.As=o,this.Xt=l,this.ai=h,this.ht=c,this.i=new b,this.ut=new E,this.ft=d,this.St=null,this.Xt&&(this._e=`${this._e}`);let f=this.ct.value?this.ct.value.split(","):null;if(d&&this.ut.ni(d)){let u=this.ut.Ht(d);u&&(f=u.includes(",")?u.split(",").map(k=>k.trim()):[u])}if(this.g=new Set(f&&f.length>0&&f[0]!==null?f.flatMap(u=>typeof u=="string"&&u.includes(",")?u.split(",").map(k=>k.trim()):u):[]),d&&this.g.size>0){let u=Array.from(this.g);this.A==="single"?window.history.pushState({},"",this.ut.X(this.ft,u[0]).st()):window.history.pushState({},"",this.ut.X(this.ft,u.join(",")).st())}this.ot=0,this.Pt=[],this.j={},this.Wt="",this.jt={container:`${this.Wt}-dr-c`,menu:`${this.Wt}dropdown-content`,search:`${this.Wt}-dr-se`,group:`${this.Wt}-dr-g`,option:`${this.Wt}dropdown-item`},this.Vt(),setTimeout(()=>{let u=new CustomEvent("init",{detail:{selected:Array.from(this.g),type:this.A,element:this.l,prefetch:this.ft}});this.l.dispatchEvent(u)},0)}Vt(){if(this.Xt==="picker"?this.i.addClass(this.l,`${this.jt.container} f_input arrow_down`):this.i.addClass(this.l,`${this.jt.container} f_input arrow_down`),this.i.setAttr(this.l,"tabindex","0"),this.g.size>0&&(this.i.setAttr(this.l,"value",Array.from(this.g).join(",")),this.i.setAttr(this.ct,"value",Array.from(this.g).join(","))),this.de(),this.ht)this.l.removeAttribute("disabled");else{this.l.setAttribute("disabled","true");return}this.l.onclick=t=>this.ue(t),document.addEventListener("keydown",t=>this.$s(t))}ue(t){this.menu?this.It():(y.currentOpenInstance&&y.currentOpenInstance.It(),this.Ms(),y.currentOpenInstance=this,this.Xt==="picker"&&(this.i.addClass(this.menu,"fe"),setTimeout(()=>{this.i.addClass(this.menu,"fee")},100)),y.globalClickListener||(y.globalClickListener=e=>{let i=y.currentOpenInstance;i&&i.menu&&!i.l.contains(e.target)&&!i.menu.contains(e.target)&&i.It()},document.addEventListener("click",y.globalClickListener)))}It(){this.menu&&(this.Xt==="picker"?(this.i.removeClass(this.menu,"fee"),setTimeout(()=>{this.menu.remove(),this.menu=null,y.currentOpenInstance===this&&(y.currentOpenInstance=null),this.l.focus()},100)):(this.menu.remove(),this.menu=null,y.currentOpenInstance===this&&(y.currentOpenInstance=null),this.l.focus()))}Ms(){if(this.menu=this.i.create({className:this.jt.menu}),this.As){let t=this.i.create({tag:"input",className:this.jt.search,attributes:{placeholder:"Search...",autocomplete:"off"}});t.addEventListener("input",i=>{this.Ts(i.target.value.toLowerCase())});let e=this.i.create({});this.i.append(e,t),this.i.append(this.menu,e)}this.Nt=this.i.create({}),this.i.append(this.menu,this.Nt),this.i.append(document.body,this.menu),this.Os(),this.li(this.s),this.St&&setTimeout(()=>{this.Ps()},0)}Os(){let t=this.l.getBoundingClientRect();this.i.style(this.menu,{position:"absolute",top:`${t.bottom+window.scrollY}px`,left:`${t.left+window.scrollX}px`,width:`${t.width}px`,zIndex:"999999999"})}li(t){this.Nt.innerHTML="",this.Pt=[],this.ot=0,this.St=null;let e=!1;t.forEach((i,s)=>{let o=this.i.create({className:this.jt.option,attributes:{tabIndex:0}});(this.g.has(String(i.value))||this.g.has(i.value)||Array.from(this.g).some(l=>String(l)===String(i.value)))&&(this.i.addClass(o,"active"),this.ot=s,e=!0);let n=document.createElement("span");n.append(i.label),o.appendChild(n),o.onclick=l=>{l.stopPropagation(),this.js(i)},this.Nt.appendChild(o),this.Pt.push(o)}),this.Pt.length>0&&this.Le(this.Pt[this.ot]),this.de()}js(t){this.A==="single"&&this.g.clear(),this.g.has(t.value)?this.g.delete(t.value):this.g.add(t.value),this.li(this.s),this.Ae(),this.A==="single"&&this.It()}Ts(t){this.Nt.querySelectorAll(`.${this.jt.option}`).forEach(e=>{let i=e.innerText.toLowerCase();e.style.display=i.includes(t)?"flex":"none"})}de(){if(this.l.innerHTML="",this.g.size===0){this.l.innerText=this._e;return}let t=[];this.s.forEach(e=>{(this.g.has(e.value)||this.g.has(String(e.value))||Array.from(this.g).some(i=>String(i)===String(e.value)))&&t.push({label:e.label,value:e.value})}),t.forEach(({label:e,value:i})=>{let s=this.i.create({tag:"span",className:"selected-tag",attributes:{"data-clearable":this.ai||!1,"data-picker":this.Xt==="picker","data-type":this.A}}),o=document.createElement("span");if(o.innerText=e,this.ht&&(o.onclick=r=>{r.stopPropagation(),this.ue(r)}),s.appendChild(o),this.ai){let r=this.i.create({tag:"span",className:"remove-tag",inner:"\xD7"});r.onclick=n=>{n.stopPropagation(),this.g.delete(i),this.de(),this.Ae()},s.appendChild(r)}this.l.appendChild(s)})}$s(t){(t.key==="Enter"||t.key===" ")&&t.target===this.l?(t.preventDefault(),this.ue(t)):!this.menu&&t.target===this.l&&(t.key==="ArrowDown"||t.key==="ArrowUp")?(t.preventDefault(),this.A==="single"?this.Is(t.key):this.ue(t)):this.menu&&this.Ns(t)}Is(t){let e=-1,i=Array.from(this.g)[0];i&&(e=this.s.findIndex(r=>r.value===i));let s;t==="ArrowDown"?s=(e+1)%this.s.length:s=(e-1+this.s.length)%this.s.length;let o=this.s[s];this.g.clear(),this.g.add(o.value),this.de(),this.Ae()}Ns(t){if(!this.menu)return;let e=this.Pt.filter(i=>i.style.display!=="none");if(e.length!==0)switch(t.key){case"ArrowDown":t.preventDefault(),this.ot=(this.ot+1)%e.length,this.Le(e[this.ot]);break;case"ArrowUp":t.preventDefault(),this.ot=(this.ot-1+e.length)%e.length,this.Le(e[this.ot]);break;case"Enter":t.preventDefault(),this.St&&this.St.click();break;case"Escape":t.preventDefault(),this.It();break;case"Tab":this.It();break}}Le(t){if(this.Pt.forEach(e=>{this.i.removeClass(e,"highlighted")}),t){this.i.addClass(t,"highlighted"),this.St=t,t.focus();let e=this.Nt,i=t.offsetTop,s=i+t.offsetHeight;i<e.scrollTop?e.scrollTop=i:s>e.scrollTop+e.clientHeight&&(e.scrollTop=s-e.clientHeight)}}Ae(){if(this.A==="single"){let e=Array.from(this.g);this.l.setAttribute("value",e.length>0?e[0]:""),this.ct.setAttribute("value",e.length>0?e[0]:"")}else this.l.setAttribute("value",Array.from(this.g).join(",")),this.ct.setAttribute("value",Array.from(this.g).join(","));if(this.ft){let e=Array.from(this.g);e.length>0?this.A==="single"?window.history.pushState({},"",this.ut.X(this.ft,e[0]).st()):window.history.pushState({},"",this.ut.X(this.ft,e.join(",")).st()):this.ut.ni(this.ft)&&window.history.pushState({},"",this.ut.Et(this.ft).st())}let t=new CustomEvent("change",{detail:Array.from(this.g)});this.l.dispatchEvent(t)}Ps(){if(!this.St)return;let t=this.Nt,e=this.St,i=e.offsetTop,s=i+e.offsetHeight;i<t.scrollTop?t.scrollTop=i:s>t.scrollTop+t.clientHeight&&(t.scrollTop=s-t.clientHeight)}Ls(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"?t.map(e=>({label:e,value:e})):t.map(e=>({label:e[this.Ds]||e.label,value:e[this._s]||e.value,imageUrl:e.imageUrl||null}))}};v(y,"currentOpenInstance",null),v(y,"globalClickListener",null);var z=y;window.DropdownSelect=z;var G=class{constructor({element:t,appendToBody:e=!1,selectedDate:i=null,minDate:s=null,maxDate:o=null,format:r="DD MMM YYYY",showAdjacentMonthDays:n=!0,quickDateOptions:l=null,permissions:h=!0}){this.o=!1,window.FLAGBUG_DEBUG&&(this.o=!0),this.Jt=(...d)=>{this.o},this.Jt("Initializing DatePicker"),this.ct=t,this.l=t,this.dt=document.createElement("div"),this.dt.className="fg-input",this.dt.setAttribute("tabindex","0"),this.l.parentNode.insertBefore(this.dt,this.l.nextSibling),this.l=this.dt,this.m=i?new Date(i):null,this.hi=s?new Date(s):null,this.ci=o?new Date(o):null,this.qs=r,this.di=n,this.I=this.m?new Date(this.m):new Date,this.xt=!1,this.j={},this.ht=h,this.gr=this.$e.bind(this),this.handleOutsideClickBound=d=>{this.xt&&!this.l.contains(d.target)&&this.qt()};let c=new Date;l&&(this.quickDateOptions=l||[{label:"Today",date:new Date},{label:"Tomorrow",date:new Date(c.getTime()+24*60*60*1e3)},{label:"In 4 days",date:new Date(c.getTime()+4*24*60*60*1e3)}]),this.prefix="f",this.staticClass={container:`${this.prefix}-d-c-c`,input:`${this.prefix}-d-i`,calendar:`${this.prefix}-d-c`,header:`${this.prefix}-d-h`,days:`${this.prefix}-d-d`,day:`${this.prefix}-d-da`},this.Vt(),this.ht&&this.Fs()}Vt(){if(this.container=document.createElement("div"),this.container.className=`${this.staticClass.container}-c`,this.m){this.l.textContent=this.rt(this.m);let t=new Date(this.m.getFullYear(),this.m.getMonth(),this.m.getDate(),12).toISOString().split("T")[0]+"T00:00:00.000Z";this.l.setAttribute("value",t),this.ct.setAttribute("value",t)}this.appendToBody?document.body.appendChild(this.container):this.l.parentNode.insertBefore(this.container,this.l.nextSibling),this.inputField=this.l,this.inputField.classList.add("f_input","arrow_down")}Fs(){this.inputField.addEventListener("click",()=>this.$e()),this.inputField.addEventListener("keydown",t=>this.gt(t)),document.addEventListener("click",t=>{this.xt&&!this.l.contains(t.target)&&this.qt()})}gt(t){if((t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.$e()),t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight")if(t.preventDefault(),this.xt)this.ui(t);else if(this.m){let e=new Date(this.m);switch(t.key){case"ArrowUp":e.setDate(e.getDate()-7);break;case"ArrowDown":e.setDate(e.getDate()+7);break;case"ArrowLeft":e.setDate(e.getDate()-1);break;case"ArrowRight":e.setDate(e.getDate()+1);break}this.Me(e)&&this.Te(e)}else this.fi();t.key==="Escape"&&this.xt&&this.qt()}$e(){this.xt?this.qt():this.fi()}fi(){this.calendar&&this.calendar.remove(),this.gi(),this.xt=!0,setTimeout(()=>{this.calendar&&(this.calendar.classList.add("fi"),this.m?this.fe(this.m):this.fe(new Date))},100)}qt(){this.calendar&&(this.calendar.classList.remove("fi"),setTimeout(()=>{this.calendar&&(this.calendar.remove(),this.calendar=null),this.l.focus()},100)),this.xt=!1}gi(){if(this.calendar=document.createElement("div"),this.calendar.className=`${this.staticClass.calendar} fie`,this.calendar.setAttribute("tabindex","-1"),this.calendar.addEventListener("click",n=>{n.stopPropagation()}),this.calendar.addEventListener("keydown",n=>this.ui(n)),this.quickDateOptions){let n=document.createElement("div");n.className=`${this.prefix}-q-d-p`,this.quickDateOptions.forEach(l=>{let h=document.createElement("div");h.className=`${this.prefix}-q-d-b`,h.textContent=l.label,this.Me(l.date)?h.addEventListener("click",()=>{this.Te(l.date)}):h.classList.add("disabled"),n.appendChild(h)}),this.calendar.appendChild(n)}let t=document.createElement("div");t.className=this.staticClass.header;let e=document.createElement("div");e.innerHTML="&#10094;",e.className="p-m",e.addEventListener("click",n=>{n.stopPropagation(),this.Bs()});let i=document.createElement("div");i.innerHTML="&#10095;",i.className="n-m",i.addEventListener("click",n=>{n.stopPropagation(),this.Rs()});let s=document.createElement("span");s.textContent=this.Us(this.I),t.appendChild(e),t.appendChild(s),t.appendChild(i),this.calendar.appendChild(t);let o=["Su","Mo","Tu","We","Th","Fr","Sa"],r=document.createElement("div");r.className=this.staticClass.days,o.forEach(n=>{let l=document.createElement("div");l.className="w",l.textContent=n,r.appendChild(l)}),this.Ys(r),this.calendar.appendChild(r),this.l.appendChild(this.calendar)}Ys(t){let e=this.I.getFullYear(),i=this.I.getMonth(),s=new Date(e,i,1),o=new Date(e,i+1,0),r=s.getDay(),n=o.getDate();if(r>0){let d=new Date(e,i,0).getDate();for(let f=0;f<r;f++){let u=document.createElement("div");if(u.className=`${this.staticClass.day} inactive disabled`,this.di){let k=d-r+f+1;u.textContent=k;let V=new Date(e,i-1,k)}t.appendChild(u)}}for(let c=1;c<=n;c++){let d=document.createElement("div");d.className=this.staticClass.day,d.textContent=c,d.setAttribute("tabindex","-1");let f=new Date(e,i,c);this.Me(f)?(this.m&&f.getDate()===this.m.getDate()&&f.getMonth()===this.m.getMonth()&&f.getFullYear()===this.m.getFullYear()?(d.classList.add("selected"),this.pr=d):!this.m&&f.getDate()===new Date().getDate()&&f.getMonth()===new Date().getMonth()&&f.getFullYear()===new Date().getFullYear()&&(d.classList.add("today"),this.mr=d),d.addEventListener("click",()=>this.Te(f))):d.classList.add("disabled"),t.appendChild(d)}let l=(r+n-1)%7,h=l<6?6-l:0;for(let c=1;c<=h;c++){let d=document.createElement("div");if(d.className=`${this.staticClass.day} inactive disabled`,this.di){d.textContent=c;let f=new Date(e,i+1,c)}t.appendChild(d)}}Me(t){return!(this.hi&&t<this.hi||this.ci&&t>this.ci)}Te(t){this.m=t,this.l.textContent=this.rt(t);let e=new Date(this.m.getFullYear(),this.m.getMonth(),this.m.getDate(),12).toISOString().split("T")[0]+"T00:00:00.000Z";this.l.setAttribute("value",e),this.ct.setAttribute("value",e),this.qt();let i={date:this.m,formatted:this.rt(this.m),iso:this.m.toISOString()};this.Hs("change",i)}Bs(){this.I.setMonth(this.I.getMonth()-1),this.Oe()}Rs(){this.I.setMonth(this.I.getMonth()+1),this.Oe()}Oe(){this.calendar&&(this.calendar.remove(),this.calendar=null),this.gi(),this.calendar&&this.calendar.classList.add("fi")}rt(t){let e=this.qs,i=t.getDate(),s=t.getMonth()+1,o=t.getFullYear(),r=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return e=e.replace(/\bMMMM\b/g,r[t.getMonth()]),e=e.replace(/\bMMM\b/g,n[t.getMonth()]),e=e.replace(/\bMM\b/g,s.toString().padStart(2,"0")),e=e.replace(/\bM\b/g,s.toString()),e=e.replace(/\bDD\b/g,i.toString().padStart(2,"0")),e=e.replace(/\bD\b/g,i.toString()),e=e.replace(/\bYYYY\b/g,o.toString()),e=e.replace(/\bYY\b/g,o.toString().slice(-2)),e}Us(t){return`${["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]} ${t.getFullYear()}`}Hs(t,e){this.j[t]&&this.j[t].forEach(i=>{i({type:t,data:e})})}wr(t){let e=this.calendar.querySelectorAll(`.${this.staticClass.day}`);e.forEach(n=>{n.classList.remove("highlighted"),n.setAttribute("aria-selected","false")});let i=t.getFullYear(),s=t.getMonth(),o=t.getDate(),r=null;e.forEach(n=>{!n.classList.contains("inactive")&&parseInt(n.textContent)===o&&(n.classList.add("highlighted"),n.setAttribute("aria-selected","true"),r=n)}),r&&r.focus()}ui(t){if(this.Jt("Calendar keydown:",t.key),t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight"){t.preventDefault(),t.stopPropagation();let e,i=this.calendar.querySelector(`.${this.staticClass.day}.highlighted`);if(i){let o=parseInt(i.textContent);e=new Date(this.I.getFullYear(),this.I.getMonth(),o)}else this.m?e=new Date(this.m):(e=new Date,e.setDate(1));let s=new Date(e);switch(t.key){case"ArrowUp":s.setDate(s.getDate()-7);break;case"ArrowDown":s.setDate(s.getDate()+7);break;case"ArrowLeft":s.setDate(s.getDate()-1);break;case"ArrowRight":s.setDate(s.getDate()+1);break}this.Jt("Current date:",e.getDate(),"New date:",s.getDate()),s.getMonth()!==this.I.getMonth()||s.getFullYear()!==this.I.getFullYear()?(this.I=new Date(s),this.Oe(),setTimeout(()=>{this.fe(s)},10)):this.fe(s)}if(t.key==="Enter"||t.key===" "){t.preventDefault(),t.stopPropagation();let e=this.calendar.querySelector(`.${this.staticClass.day}.highlighted`);e&&e.click()}t.key==="Escape"&&(t.preventDefault(),t.stopPropagation(),this.qt())}fe(t){let e=this.calendar.querySelectorAll(`.${this.staticClass.day}`),i=t.getDate();e.forEach(o=>{o.classList.remove("highlighted"),o.setAttribute("aria-selected","false")});let s=null;e.forEach(o=>{!o.classList.contains("inactive")&&parseInt(o.textContent)===i&&(o.classList.add("highlighted"),o.setAttribute("aria-selected","true"),s=o)}),s?(s.focus(),this.Jt("Focused on day:",i)):this.Jt("Could not find day element for:",i)}};window.DatePicker=G;var K,lt,Z,ht,Q,ct,ot=class{constructor(){D(this,K);D(this,Z);D(this,Q);this.info={os:J(this,K,lt).call(this),browser:J(this,Z,ht).call(this),device:J(this,Q,ct).call(this),pixelRatio:window.devicePixelRatio||1,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},document:{width:document.documentElement.scrollWidth,height:document.documentElement.scrollHeight},scrollX:window.scrollX,scrollY:window.scrollY,orientation:screen.orientation?screen.orientation.type:"unknown",vh:window.innerHeight*.01,vw:window.innerWidth*.01,mouseX:0,mouseY:0}}getInfo(){return this.info}};K=new WeakSet,lt=function(){let{userAgent:t,platform:e}=navigator,i=["Macintosh","MacIntel","MacPPC","Mac68K"],s=["Win32","Win64","Windows","WinCE"],o=["iPhone","iPad","iPod"];return i.includes(e)?"macOS":o.includes(e)?"iOS":s.includes(e)?"Windows":/Android/.test(t)?"Android":/Linux/.test(e)?"Linux":"Unknown"},Z=new WeakSet,ht=function(){let t=navigator.userAgent;return t.includes("Firefox/")?"Firefox":t.includes("Edg/")?"Edge":t.includes("Chrome/")&&!t.includes("Edg/")?"Chrome":t.includes("Safari/")&&!t.includes("Chrome/")?"Safari":t.includes("OPR/")||t.includes("Opera")?"Opera":"Unknown"},Q=new WeakSet,ct=function(){let t=navigator.userAgent;return/Mobi|Android/i.test(t)?"Mobile":/Tablet|iPad/i.test(t)?"Tablet":"Desktop"};var dt=ot;var _=class{constructor(t,e=null){this.o=!1,this.zt=t,this.s=e,this.W={},this.V={},this.S={},this.M={},this.pi=[],this.Pe=!1,this.ge=!1,this.je=!1,this.C={appendErrorAfter:".fg-input"},this.zt.addEventListener("submit",this.Xs.bind(this)),this.Ws()}Ws(){new MutationObserver(()=>{Object.keys(this.W).forEach(e=>{var s;let i=(s=this.W[e])==null?void 0:s.Gt;if(i&&i.type==="hidden"){let o=i.value;this.S[e]!==o&&(this.S[e]=o,this.M[e]=!0,this.pe(e),this.Kt(),this.pt())}})}).observe(this.zt,{subtree:!0,attributes:!0,attributeFilter:["value"],childList:!1})}registerFields(t={}){Object.entries(t).forEach(([e,i])=>{this.Vs(e,i)})}Vs(t,e={}){let i=this.zt.querySelector(`[name="${t}"]`);i&&(this.W[t]={Gt:i,Js:e},this.S[t]=i.value||"",this.M[t]=!1,i.addEventListener("input",()=>{this.S[t]=i.value,this.M[t]=!0,this.pe(t),this.Kt(),this.pt()}),i.addEventListener("blur",()=>{this.M[t]=!0,this.pt()}))}setValue(t,e){let i=this.W[t];i&&(i.Gt.value=e,this.S[t]=e,this.M[t]=!0,this.pe(t),this.Kt(),this.pt())}setTouched(t,e=!0){t in this.M&&(this.M[t]=e,this.pt())}pe(t){let{Gt:e,Js:i}=this.W[t],s=e.value;this.S[t]=s,i.required&&!s?this.V[t]=i.required||"This field is required.":i.pattern&&!i.pattern.test(s)?this.V[t]=i.patternMessage||"Invalid format.":i.minLength&&s.length<i.minLength?this.V[t]=i.minLengthMessage||`Minimum length is ${i.minLength}.`:delete this.V[t]}zs(){let t=!0;return Object.keys(this.W).forEach(e=>{this.pe(e),this.V[e]&&(t=!1)}),t}async Xs(t){t.preventDefault(),Object.keys(this.W).forEach(i=>{this.M[i]=!0}),this.ge=!0,this.pt();let e=this.zs();if(this.Kt(),e||this.Gs(),this.Pe=!0,this.ge=!1,this.je=e,this.pt(),e){if(this.Ks().length===0){this.o,window.w.create({title:"No changes detected",message:"Please make changes before submitting.",type:"warning"});return}this.Ie(this.S)}else this.Ne(this.V)}Ks(){if(!this.s)return!0;let t=[],e={},i=(s,o)=>{if(o==="due_date"){let r=new Date(s);return isNaN(r)?"":r.toISOString().split("T")[0]}return Array.isArray(s)?s.join(","):typeof s=="object"&&s!==null?JSON.stringify(s):typeof s=="number"?String(s):typeof s=="string"?s.trim():s!=null?s:""};return Object.keys(this.S).some(s=>{let o=i(this.S[s],s),r=i(this.s[s],s);o!==r&&(t.push({key:s,originalValue:r,currentValue:o}),e[s]=o)}),this.S=e,t.length>0&&(this.o,t.forEach(({key:s,originalValue:o,currentValue:r})=>{this.o})),t}Gs(){var e,i,s;let t=Array.from(this.zt.querySelectorAll("[name]"));for(let o of t){let r=o.getAttribute("name");if(this.V[r]){let n=(e=this.W[r])==null?void 0:e.Gt;if((n==null?void 0:n.type)==="hidden"){let l=((i=n.closest(".fg-form-group"))==null?void 0:i.querySelector(".fg-input[tabindex]"))||((s=n.closest(".fg-form-group"))==null?void 0:s.querySelector(".fg-input"));if(l){typeof l.focus=="function"?l.focus():l.scrollIntoView({behavior:"smooth",block:"center"});return}}n&&typeof n.focus=="function"&&n.focus();return}}}Ie(t){}Ne(t){}watch(t){this.pi.push(t),t(this.S,this.M)}pt(){this.pi.forEach(t=>t(this.S,this.M))}Kt(){Object.keys(this.W).forEach(t=>{var r;let{Gt:e}=this.W[t],i=this.V[t],s,o;if(e.classList.remove("fg-error"),e.type==="hidden"&&(o=(r=e.closest(".fg-form-group"))==null?void 0:r.querySelector(".fg-input[tabindex]"),o&&o.classList.remove("fg-error")),i)e.type==="hidden"&&o?(o.classList.add("fg-error"),s=o.nextElementSibling,(!s||!s.classList.contains("error"))&&(s=document.createElement("div"),s.className="error",o.after(s))):(e.classList.add("fg-error"),s=e.nextElementSibling,(!s||!s.classList.contains("error"))&&(s=document.createElement("div"),s.className="error",e.after(s))),s.textContent=i;else{let n=e.type==="hidden"&&o?o.nextElementSibling:e.nextElementSibling;n&&n.classList.contains("error")&&n.remove()}})}getValues(){return p({},this.S)}getTouchedFields(){return p({},this.M)}getErrors(){return p({},this.V)}getFormState(){return{isSubmitted:this.Pe,isSubmitting:this.ge,isSubmitSuccessful:this.je,touchedFields:p({},this.M)}}resetForm(){this.zt.reset(),this.S={},this.V={},this.M={},this.Pe=!1,this.ge=!1,this.je=!1,this.pt(),this.Kt()}};var T=class{constructor(t={}){this.o=!0,this.Ft=t.Ft,this.n=t.n,this.me={onFormCreated:[],onFormSubmitted:[],onFormCanceled:[],onFormDone:[],onFormDeleted:[]}}form(t,e){return this.me[t]?(this.me[t].push(e),!0):!1}Bt(t,e){this.me[t]&&this.me[t].forEach(i=>i(e))}mi(t=null){let{type:e,action:i}=t,s=i==="update"?"fg-update-task-form":"fg-create-task-form",o="",r="";e==="comment"&&i==="update"&&(o=' <div class="fg-form-group"><a name="screenshot"href=""target="_blank">View Screenshot </a></div>',r=' <div class="fg-bug-info-container"><div class="fg-bug-user"></div><div class="fg-bug-date"></div><div class="fg-bug-info"></div></div>');let n=` <div class="fg-create-task fg-cover fg-anim"id="${s}"><div class="fg-title">${i==="update"?`Update Task ${r}`:"Create Task"}</div><form class="fg-create-task-form fg-layout"><!-- Title --><div class="fg-form-group"control="title"><label for="title">Title</label><input class="fg-input"type="text"id="title"name="title"placeholder="Title"></div><!-- Description --><div class="fg-form-group"control="description"><label for="description">Description</label><textarea class="fg-input"id="description"name="description"placeholder="Description"></textarea></div><!-- Due Date --><div class="fg-form-group"control="due_date"><label for="due_date">Due Date</label><input class="fg-input"type="hidden"id="due_date"name="due_date"placeholder="Due Date"></div><!-- assigned_to --><div class="fg-form-group fg-width-50"control="assigned_to"><label for="assigned_to">Assigned To</label><input class="fg-input"type="hidden"id="assigned_to"name="assigned_to"placeholder="Assigned To"></div><!-- Priority --><div class="fg-form-group fg-width-50"control="priority"><label for="priority">Priority</label><input class="fg-input"type="hidden"id="priority"name="priority"placeholder="Priority"></div><!-- Status --><div class="fg-form-group"control="status"><label for="status">Status</label><input class="fg-input"type="hidden"id="status"name="status"placeholder="Status"></div><!-- Status -->${o} <!-- Submit Button --><div class="fg-form-group"><input class="fg-submit fg-button"type="submit"value="${i==="update"?"Update Task":"Create Task"}"><input class="fg-cancel fg-button"type="button"value="Cancel">${t.action==="update"?'<input class="fg-delete fg-button" type="button" value="Delete">':""} </div></form></div>`,l=null;i==="update"||e==="comment"?l=document.body:i==="create"&&e==="screenshot"?l=document.querySelector(".__m__"):i==="create"&&e==="comment"&&(l=document.body),l.insertAdjacentHTML("beforeend",n);let h=document.getElementById(s);setTimeout(()=>{this.Bt("onFormCreated",{formId:s,form:h})},0);let c=h.querySelector(".fg-cancel");c&&c.addEventListener("click",()=>{this.Bt("onFormCanceled",{formId:s,form:h}),h.remove(),e==="screenshot"&&document.querySelector("#FlagBugIO__screenshot").remove()})}wi(t,e=null){let i=t.getAttribute("id");if(!t){this.o;return}let s=!0,o="",r=t.querySelector(".fg-delete");if(e.hasOwnProperty("created_by")){let{isSameUser:n,role:l}=this.n.getUserPermissions(e);s=n,o=l,n?r.addEventListener("click",()=>{confirm("Are you sure you want to delete this task?")&&(this.Ot(e.id),t.remove())}):r.remove()}if(e){let n=t.querySelector('[name="screenshot"]');e.screenshot!==null&&e.screenshot&&(n.href=this.n.le+e.screenshot),n&&e.mode!=="screenshot"&&n.closest(".fg-form-group").remove(),Object.keys(e).forEach(l=>{let h=t.querySelector(`[name="${l}"]`);h&&(h.value=e[l],!s&&o!=="admin"&&l!=="status"&&(h.disabled=!0,h.closest(".fg-form-group").classList.add("fg-disabled")))})}}getTooltipTemplate(t){return` <div class="bug-info-tooltip"><div class="bug-info-line"><div class="bug-info-label">Browser</div><div class="bug-info-value">${t.browser}</div></div><div class="bug-info-line"><div class="bug-info-label">Os</div><div class="bug-info-value">${t.os}</div></div><div class="bug-info-line"><div class="bug-info-label">Device</div><div class="bug-info-value">${t.device}</div></div><div class="bug-info-line"><div class="bug-info-label">Resolution</div><div class="bug-info-value">${t.viewport.width}x${t.viewport.height}</div></div></div>`}yi(t){let e=t.querySelector("#due_date"),i=t.querySelector("#assigned_to"),s=t.querySelector("#priority"),o=t.querySelector("#status"),r=e.disabled,n=i.disabled,l=s.disabled,h=o.disabled;new DatePicker({element:e,permissions:!r,selectedDate:this.vi?this.vi:new Date}),new DropdownSelect({element:i,data:this.n.tt,type:"single",key:"user_name",value:"user_id",style:"picker",permissions:!n,placeholder:"Select Assignee"}),new DropdownSelect({element:s,data:this.n.U,type:"single",key:"label",value:"value",style:"picker",permissions:!l}),new DropdownSelect({element:o,data:this.n.Y,type:"single",key:"label",value:"value",style:"picker",permissions:!h})}Zs(t=null,e="comment"){this.mi({type:e,action:"create"});let i=document.querySelector("#fg-create-task-form");t&&this.wi(i,t),this.yi(i),this.Qs(i)}Ot(t=null){if(!t){this.o;return}window.kt.Ot({id:t}),this.Bt("onFormDeleted",{taskId:t}),window.k.bi(t)}Qs(t){if(!t)return;let e=new _(t);e.registerFields({title:{required:"Title is required"},description:{required:"Description is required"},due_date:{required:"Due date is required"},assigned_to:{required:"Assignee required"},priority:{required:"Priority required"},status:{required:"Status required"}}),e.Ie=async i=>{this.o;let s=t.getAttribute("type"),o=this.eo();if(!window.T){window.w.create({title:"Error",description:"Please select a position on the screen canvas.",type:"error"});return}o.screeninfo.mouseX=window.T.mouseX,o.screeninfo.mouseY=window.T.mouseY,o.mode=s,o.href=window.v.Es();let r=p(p({},o),i);this.o,this.Bt("onFormSubmitted",{form:t,formId:t.id,data:i,payload:r,isUpdate:!1});let n=await window.kt.ys({payload:r});n&&(this.Bt("onFormDone",{formId:t.id,response:n}),t.remove())},e.Ne=i=>{this.o}}et(t=null){if(!t){this.o;return}let e=window.p.h.find(o=>o.id===t);if(!e){this.o;return}let i=e.mode;this.vi=e.due_date,this.mi({type:"comment",action:"update"});let s=document.querySelector("#fg-update-task-form");this.wi(s,e),this.io(s,e),this.yi(s),window.J.setFormPosition(s,e.screeninfo),this.so(s,e)}io(t,e){if(t.getAttribute("id")==="fg-update-task-form"){let s=t.querySelector(".fg-bug-user"),o=t.querySelector(".fg-bug-date"),r=t.querySelector(".fg-bug-info");s.textContent=e.created_by,o.textContent=window.rt(e.created_at,!0),r.textContent="H",window.oo({selector:".fg-bug-info",trigger:"click",interactive:!1,html:!0,content:this.getTooltipTemplate(e.screeninfo)})}}so(t,e){var o;if(!t)return;let i=C(p({},e),{assigned_to:String(((o=e.assigned_to)==null?void 0:o[0])||"")}),s=new _(t,i);s.registerFields({title:{required:"Title is required"},description:{required:"Description is required"},due_date:{required:"Due date is required"},assigned_to:{required:"Assignee required"},priority:{required:"Priority required"},status:{required:"Status required"}}),s.Ie=async r=>{this.o;let n=p({},r);n.created_by=e.created_by;let l=await this.Ft.et({id:e.id,payload:n});l&&(this.Bt("onFormDone",{formId:t.id,response:l}),t.remove())},s.Ne=r=>{this.o}}eo(){let t=new dt;return{project_id:this.n.E.project_id,created_by:this.n.c.id,screeninfo:t.getInfo()}}};var L=class{constructor(){this.i=new b}create({title:t,description:e,type:i="info",duration:s=5e3}){let o=this.i.create({tag:"div",className:`fg-toast ${i}`}),r=this.i.create({tag:"div",className:"fg-toast_close",inner:'<svg width="13"height="13"viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"stroke-linecap="round"stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>'});if(this.i.on(r,"click",()=>{this.close()}),o.append(r),t){let l=this.i.create({tag:"div",className:"fg-toast_title",inner:t});o.append(l)}if(e){let l=this.i.create({tag:"div",className:"fg-toast_message",inner:e});o.append(l)}this.w=o;let n=document.querySelector(".fg-toast-container");n||(n=this.i.create({tag:"div",className:"fg-toast-container"}),this.i.append(document.body,n)),this.i.append(n,this.w),this.qe=n,this.w.classList.add("fie"),setTimeout(()=>{this.w.classList.add("fi")},100),setTimeout(()=>{this.close()},s)}close(){this.w.remove(),this.qe&&this.qe.children.length===0&&this.qe.remove()}};window.Toast=L;function ut(a){return new rt(a)}var rt=class a{constructor(t){if(this.elements=[],!!t){if(t instanceof Element||t instanceof Document){this.elements=[t];return}if(typeof t=="string")if(t.trim().startsWith("<")&&t.trim().endsWith(">")){let e=document.createElement("template");e.innerHTML=t.trim(),this.elements=[...e.content.childNodes].filter(i=>i.nodeType===1)}else this.elements=[...document.querySelectorAll(t)]}}first(){return this.elements[0]||null}get(t=0){return this.elements[t]||null}on(t,e){return this.elements.forEach(i=>i.addEventListener(t,e)),this}off(t,e){return this.elements.forEach(i=>i.removeEventListener(t,e)),this}addClass(t){return this.elements.forEach(e=>e.classList.add(t)),this}removeClass(t){return this.elements.forEach(e=>e.classList.remove(t)),this}toggleClass(t){return this.elements.forEach(e=>e.classList.toggle(t)),this}css(t,e){return typeof t=="object"?this.elements.forEach(i=>{Object.entries(t).forEach(([s,o])=>{i.style[s]=o})}):typeof t=="string"&&e!==void 0&&this.elements.forEach(i=>{i.style[t]=e}),this}html(t){var e;return t===void 0?((e=this.first())==null?void 0:e.innerHTML)||"":(this.elements.forEach(i=>{i.innerHTML=t}),this)}text(t){var e;return t===void 0?((e=this.first())==null?void 0:e.textContent)||"":(this.elements.forEach(i=>{i.textContent=t}),this)}attr(t,e){var i;return e===void 0?((i=this.first())==null?void 0:i.getAttribute(t))||"":(this.elements.forEach(s=>{s.setAttribute(t,e)}),this)}append(t){if(t instanceof a)t=t.elements;else if(typeof t=="string"){let e=document.createElement("template");e.innerHTML=t,t=[...e.content.childNodes]}else t instanceof Element?t=[t]:t=[];return this.elements.forEach(e=>{t.forEach(i=>{e.appendChild(i.cloneNode(!0))})}),this}remove(){return this.elements.forEach(t=>t.remove()),this.elements=[],this}find(t){let e=new a;return this.elements.forEach(i=>{e.elements.push(...i.querySelectorAll(t))}),e}each(t){return this.elements.forEach((e,i)=>t.call(e,i,e)),this}val(t){if(t===void 0){let e=this.first();return e&&e.value||""}return this.elements.forEach(e=>{"value"in e&&(e.value=t)}),this}};typeof window<"u"&&(window.$=ut);var ft=ut;async function gt(a,t,e,i){try{return new Promise(s=>{if(typeof t=="string"){let o=new Image;o.onload=()=>{e=o.width,i=o.height;let r=new fabric.Image(o);St(a,r,e,i),s(!0)},o.onerror=r=>{s(!1)},o.crossOrigin="anonymous",o.src=t}else s(!1)})}catch(s){return!1}}function St(a,t,e,i){a.setWidth(e||t.width),a.setHeight(i||t.height),a.setBackgroundImage(t,a.renderAll.bind(a),{scaleX:(e||t.width)/t.width,scaleY:(i||t.height)/t.height,originX:"left",originY:"top",lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,selectable:!1,evented:!1,crossOrigin:"anonymous"}),a.renderAll()}var O=class{constructor(t){this.t=t,this.b=null,this.J=new Map,this.Fe=this.Fe.bind(this),this.Zt=this.Zt.bind(this),this.Be=this.Be.bind(this),this.t.on("mouse:down",this.Fe),this.t.on("mouse:move",this.Zt),this.t.on("mouse:up",this.Be)}ro(t,e){!t||!e||this.J.set(t,e)}ki(t){let e=this.J.get(t);if(!e)return!1;let i=!1;return this.b===e?(e.deactivate(),this.b=null):(this.b&&this.b.deactivate(),e.activate(),this.b=e,i=!0),i}yr(t){let e=this.J.get(t);return e?(this.b===e||(this.b&&this.b.deactivate(),e.activate(),this.b=e),!0):!1}vr(){return this.b?(this.b.deactivate(),this.b=null,!0):!1}Fe(t){var e;(e=this.b)!=null&&e.onMouseDown&&this.b.onMouseDown(t)}Zt(t){var e;(e=this.b)!=null&&e.onMouseMove&&this.b.onMouseMove(t)}Be(t){var e;(e=this.b)!=null&&e.onMouseUp&&this.b.onMouseUp(t)}};var S=class S{static getCurrentColor(){return S.defaultColor}static setCurrentColor(t){S.defaultColor=t}static applyColor(t,e,i){e&&(e.type==="activeSelection"?(e.getObjects().forEach(s=>{S.applyColorToObject(s,i)}),e.dirty=!0):S.applyColorToObject(e,i),t.requestRenderAll())}static applyColorToObject(t,e){switch(t.type){case"text":case"i-text":case"textbox":case"Textbox":t.set({fill:e,dirty:!0});break;case"rect":case"circle":case"ellipse":t.set({stroke:e,dirty:!0});break;case"line":case"path":t.set({stroke:e,dirty:!0});break;case"group":t.isPartOfArrow&&t.getObjects().forEach(i=>{i.type==="triangle"&&i.set("fill",e),i.set("stroke",e)});break;default:t.isPartOfArrow&&(t.type==="triangle"&&t.set("fill",e),t.set("stroke",e));break}t.setCoords()}static updateColorIndicator(t,e){}};v(S,"defaultColor","#ff0000");var w=S;var P=class{constructor(t,e){this.t=t,this.Ci=e,this.u=!1,this.r=null,this.z=null,this.G=null,this.a=!1}activate(){this.a=!0,this.Ci.classList.add("active"),this.u=!1,this.r=null,this.z=null,this.G=null,this.t.selection=!1,this.t.defaultCursor="crosshair"}deactivate(){this.a=!1,this.Ci.classList.remove("active"),this.u=!1,this.r=null,this.z=null,this.G=null,this.t.selection=!0,this.t.defaultCursor="default"}onMouseDown(t){!this.a||t.target||(this.u=!0,this.r=t.absolutePointer,this.z=new fabric.Line([this.r.x,this.r.y,this.r.x,this.r.y],{stroke:w.getCurrentColor(),strokeWidth:2,tempDrawingObject:!0,isPartOfArrow:!0}),this.t.add(this.z),this.G=new fabric.Triangle({left:this.r.x,top:this.r.y,originX:"center",originY:"center",angle:0,width:10,height:10,fill:w.getCurrentColor(),tempDrawingObject:!0,isPartOfArrow:!0}),this.t.add(this.G))}onMouseMove(t){if(!this.a||!this.u||!this.z||!this.G)return;let e=t.absolutePointer;this.z.set({x2:e.x,y2:e.y});let i=Math.atan2(e.y-this.r.y,e.x-this.r.x)*(180/Math.PI);this.G.set({left:e.x,top:e.y,angle:i+90}),this.t.requestRenderAll()}onMouseUp(){if(!this.a||!this.u||!this.z||!this.G)return;this.u=!1;let t=new fabric.Group([this.z,this.G],{selectable:!0,hasControls:!0,originX:"center",originY:"center",isPartOfArrow:!0});this.t.remove(this.z),this.t.remove(this.G),this.t.add(t),this.r=null,this.z=null,this.G=null,this.t.requestRenderAll()}};var j=class{constructor(t,e){this.t=t,this.Ei=e,this.u=!1,this.r=null,this.N=null,this.a=!1,this.q=this.q.bind(this),this.Dt=this.Dt.bind(this),this.F=this.F.bind(this)}activate(){this.a=!0,this.Ei.classList.add("active"),this.u=!1,this.r=null,this.N=null,this.t.selection=!1,this.t.defaultCursor="crosshair",this.t.on("mouse:down",this.q),this.t.on("mouse:move",this.Dt),this.t.on("mouse:up",this.F)}deactivate(){this.a=!1,this.Ei.classList.remove("active"),this.u=!1,this.r=null,this.N=null,this.t.selection=!0,this.t.defaultCursor="default",this.t.off("mouse:down",this.q),this.t.off("mouse:move",this.Dt),this.t.off("mouse:up",this.F)}q(t){!this.a||t.target||(this.u=!0,this.r=t.absolutePointer,this.N=new fabric.Rect({left:this.r.x,top:this.r.y,width:0,height:0,stroke:w.getCurrentColor(),strokeWidth:2,fill:"transparent",selectable:!1,evented:!1,tempDrawingObject:!0}),this.t.add(this.N),this.t.renderAll())}Dt(t){if(!this.a||!this.u)return;let e=t.absolutePointer,i=e.x-this.r.x,s=e.y-this.r.y;this.N.set({width:Math.abs(i),height:Math.abs(s),left:i>0?this.r.x:e.x,top:s>0?this.r.y:e.y}),this.t.renderAll()}F(){if(!this.a||!this.u)return;this.u=!1,this.t.remove(this.N);let t=new fabric.Rect({left:this.N.left,top:this.N.top,width:this.N.width,height:this.N.height,stroke:this.N.stroke,strokeWidth:2,fill:"transparent",selectable:!0,evented:!0});this.t.add(t),this.t.setActiveObject(t),this.t.renderAll(),this.N=null,this.t.trigger&&this.t.trigger("object:modified")}};var I=class{constructor(t,e){this.t=t,this.Si=e,this.u=!1,this.r=null,this.O=null,this.a=!1}activate(){this.a=!0,this.Si.classList.add("active"),this.u=!1,this.r=null,this.O=null,this.t.selection=!1,this.t.defaultCursor="crosshair"}deactivate(){this.a=!1,this.Si.classList.remove("active"),this.u=!1,this.r=null,this.O=null,this.t.selection=!0,this.t.defaultCursor="default"}onMouseDown(t){!this.a||t.target||(this.u=!0,this.r=t.absolutePointer,this.O=new fabric.Ellipse({left:this.r.x,top:this.r.y,rx:1,ry:1,stroke:w.getCurrentColor(),strokeWidth:2,fill:"rgba(0,0,0,0)",selectable:!1,hasControls:!1,originX:"left",originY:"top",tempDrawingObject:!0}),this.t.add(this.O))}onMouseMove(t){if(!this.a||!this.u||!this.O)return;let e=t.absolutePointer,i=Math.abs(e.x-this.r.x),s=Math.abs(e.y-this.r.y);this.O.set({rx:i/2,ry:s/2,left:Math.min(this.r.x,e.x),top:Math.min(this.r.y,e.y)}),this.t.requestRenderAll()}onMouseUp(){if(!this.a||!this.u||!this.O)return;this.u=!1;let t=new fabric.Ellipse({left:this.O.left,top:this.O.top,rx:this.O.rx,ry:this.O.ry,stroke:w.getCurrentColor(),strokeWidth:2,fill:"rgba(0,0,0,0)",selectable:!0,hasControls:!0,originX:"left",originY:"top",tempDrawingObject:!1});this.t.remove(this.O),this.t.add(t),this.t.setActiveObject(t),this.r=null,this.O=null,this.t.requestRenderAll()}};var N=class{constructor(t,e){this.t=t,this.xi=e,this.u=!1,this.a=!1,this.br=null}activate(){this.a=!0,this.xi.classList.add("active"),this.t.isDrawingMode=!0,this.t.freeDrawingBrush=new fabric.PencilBrush(this.t),this.t.freeDrawingBrush.color=w.getCurrentColor(),this.t.freeDrawingBrush.width=2}deactivate(){this.a=!1,this.xi.classList.remove("active"),this.t.isDrawingMode=!1}};var q=class{constructor(t,e){this.t=t,this.Di=e,this.u=!1,this.r=null,this.P=null,this.a=!1}activate(){this.a=!0,this.Di.classList.add("active"),this.u=!1,this.r=null,this.P=null,this.t.selection=!1,this.t.defaultCursor="crosshair"}deactivate(){this.a=!1,this.Di.classList.remove("active"),this.u=!1,this.r=null,this.P=null,this.t.selection=!0,this.t.defaultCursor="default"}onMouseDown(t){!this.a||t.target||(this.u=!0,this.r=t.absolutePointer,this.P=new fabric.Rect({left:this.r.x,top:this.r.y,width:0,height:0,fill:"rgba(255, 0, 0, 0.5)",stroke:"red",strokeWidth:2,selectable:!1,hasControls:!1}),this.t.add(this.P))}onMouseMove(t){if(!this.a||!this.u||!this.P)return;let e=t.absolutePointer,i=e.x-this.r.x,s=e.y-this.r.y;this.P.set({width:Math.abs(i),height:Math.abs(s),left:i<0?e.x:this.r.x,top:s<0?e.y:this.r.y}),this.t.requestRenderAll()}onMouseUp(){if(!this.a||!this.u||!this.P)return;this.u=!1;let t=new fabric.Rect({left:this.P.left,top:this.P.top,width:this.P.width,height:this.P.height,fill:"rgba(255, 0, 0, 1)",stroke:"red",strokeWidth:2,selectable:!0,hasControls:!0});this.t.remove(this.P),this.t.add(t),this.t.setActiveObject(t),this.r=null,this.P=null,this.t.requestRenderAll()}};var F=class{constructor(t,e){this.t=t,this.Re=e,this.a=!1,this.K=null,this._i={"Smiling & Affectionate":["\u{1F600}","\u{1F603}","\u{1F604}","\u{1F601}","\u{1F606}","\u{1F605}","\u{1F923}","\u{1F602}","\u{1F642}","\u{1F609}","\u{1F60A}","\u{1F607}","\u{1F970}","\u{1F60D}","\u{1F929}","\u{1F618}","\u{1F617}","\u263A\uFE0F","\u{1F61A}","\u{1F619}","\u{1F972}","\u{1F60F}"],"Hands & Body Parts":["\u{1F44B}","\u{1F91A}","\u{1F590}\uFE0F","\u270B","\u{1F596}","\u{1FAF1}","\u{1FAF2}","\u{1F91F}","\u{1F918}","\u{1F919}","\u{1F448}","\u{1F449}","\u{1F446}","\u{1F595}","\u{1F447}","\u261D\uFE0F","\u{1FAF5}","\u{1F44D}","\u{1F44E}","\u270A","\u{1F44A}","\u{1F91B}","\u{1F91C}","\u{1F44F}","\u{1F64C}","\u{1FAF6}","\u{1F450}","\u{1F932}","\u{1F91D}","\u{1F64F}","\u270D\uFE0F"]}}activate(){this.a||(this.a=!0,this.Re.classList.add("active"),this.no())}deactivate(){this.a&&(this.a=!1,this.Re.classList.remove("active"),this.K&&(this.K.remove(),this.K=null))}no(){this.K&&this.K.remove(),this.K=document.createElement("div"),this.K.classList.add("pickerContainer"),Object.keys(this._i).forEach(t=>{let e=document.createElement("div");e.textContent=t,e.classList.add("categoryTitle"),this.K.appendChild(e);let i=document.createElement("div");i.classList.add("emojiRow"),this._i[t].forEach(s=>{let o=document.createElement("span");o.textContent=s,o.classList.add("emojiButton"),o.addEventListener("click",()=>this.ao(s)),i.appendChild(o)}),this.K.appendChild(i)}),this.Re.appendChild(this.K)}ao(t){let e={x:this.t.width/2,y:this.t.height/2},i=new fabric.Text(t,{left:e.x,top:e.y,fontSize:40,selectable:!0,hasControls:!0,originX:"center",originY:"center"});this.t.add(i),this.t.setActiveObject(i),this.t.requestRenderAll(),this.deactivate()}};var nt=class{constructor(t,e){this.t=t,this.Li=e,this.a=!1,this.q=this.q.bind(this),this.F=this.F.bind(this),this.mt=null,this.we=null}activate(){this.a||(this.a=!0,this.Li.classList.add("active"),this.t.on("mouse:down",this.q),this.t.on("mouse:up",this.F))}deactivate(){this.a&&(this.a=!1,this.Li.classList.remove("active"),this.t.off("mouse:down",this.q),this.t.off("mouse:up",this.F))}q(t){if(!this.a||this.t.getActiveObject())return;let i=this.t.getPointer(t.e);this.mt={x:i.x,y:i.y}}F(t){if(!this.a||this.t.getActiveObject())return;let i=this.t.getPointer(t.e);this.we={x:i.x,y:i.y};let s=150;if(this.mt&&this.we){let l=Math.abs(this.we.x-this.mt.x);l>150&&(s=l)}let o=this.mt?this.mt.x:i.x,r=this.mt?this.mt.y:i.y,n=new fabric.Textbox("New Text",{left:o,top:r,fontSize:20,fill:w.getCurrentColor(),width:s,whiteSpace:"pre"});this.t.add(n),this.t.setActiveObject(n),n.enterEditing(),requestAnimationFrame(()=>{n.selectAll(),n.renderCursorOrSelection()}),this.mt=null,this.we=null,this.t.renderAll()}},pt=nt;var B=class{constructor(t,e){this.t=t,this.Qt=e,this.a=!1,this.wt=null,this.lo=["#ff0000","#00ff00","#0000ff","#ffcc00","#ff00ff"],w.updateColorIndicator(this.Qt,w.getCurrentColor())}activate(){this.a=!0,this.Qt.classList.add("active"),this.showColorPicker()}deactivate(){this.a=!1,this.Qt.classList.remove("active"),this.wt&&(this.wt.remove(),this.wt=null)}showColorPicker(){this.wt||(this.wt=document.createElement("div"),this.wt.classList.add("color-picker-container"),this.lo.forEach(t=>{let e=document.createElement("div");e.classList.add("color-box"),e.style.backgroundColor=t,e.dataset.color=t,e.addEventListener("click",()=>this.applyColor(t)),this.wt.appendChild(e)}),this.Qt.appendChild(this.wt))}applyColor(t){if(!this.a)return;let e=this.t.getActiveObject();e&&w.applyColor(this.t,e,t),w.setCurrentColor(t),w.updateColorIndicator(this.Qt,t),this.deactivate()}};var R=class{constructor(t,e){this.t=t,this.Ai=e}activate(){this.Ai.classList.add("active");let t=document.createElement("input");t.type="file",t.accept="image/*",t.style.display="none",document.body.appendChild(t),t.click(),t.addEventListener("change",e=>{this.handleFileUpload(e,t)},{once:!0}),t.addEventListener("click",()=>setTimeout(()=>t.remove(),500),{once:!0})}deactivate(){this.Ai.classList.remove("active")}handleFileUpload(t,e){let i=t.target.files[0];if(!i){this.deactivate(),e.remove();return}let s=new FileReader;s.onload=o=>{fabric.Image.fromURL(o.target.result,r=>{r.set({left:50,top:50,scaleX:.5,scaleY:.5,selectable:!0,hasControls:!0}),this.t.add(r),this.t.setActiveObject(r),this.t.requestRenderAll(),e.remove(),this.deactivate()})},s.readAsDataURL(i)}};var U=class{constructor(t,e,i,s=50){this.t=t,this.D=[],this.Rt=[],this._t=!0,this.Lt=e,this.At=i,this.ho=s,this.gt=this.gt.bind(this),this.te=this.te.bind(this),this.ee=this.ee.bind(this),this.nt=this.nt.bind(this),this.Ue()}Ue(){this.t.on("object:modified",()=>{let t=this.t.getActiveObject();t&&t.selectable&&this.nt()}),this.t.on("object:added",t=>{if(t.target&&t.target.selectable){if(t.target.tempDrawingObject)return;t.target.type==="group"?this.nt():!t.target.tempDrawingObject&&!t.target.isPartOfArrow&&this.nt()}}),this.t.on("mouse:up",t=>{this.t.isDrawingMode&&this.nt()}),this.t.on("path:created",()=>{this.nt()}),document.addEventListener("keydown",this.gt),this.Lt&&this.Lt.addEventListener("click",this.te),this.At&&this.At.addEventListener("click",this.ee),this.Ut()}gt(t){if(t.target.matches("input, textarea"))return;let e=t.key.toLowerCase(),i=navigator.platform.toUpperCase().includes("MAC"),s=(i?t.metaKey:t.ctrlKey)&&!t.shiftKey&&e==="z",o=(i?t.metaKey:t.ctrlKey)&&t.shiftKey&&e==="z";s?(t.preventDefault(),this.te()):o&&(t.preventDefault(),this.ee())}nt(){if(this._t)try{let t=this.t.getObjects().filter(i=>i.selectable),e=JSON.stringify(t);if(this.D.length>0&&this.D[this.D.length-1]===e)return;this.D.push(e),this.D.length>this.ho&&this.D.shift(),this.Rt=[],this.ye("State Saved"),this.Ut()}catch(t){}}te(){if(this.D.length!==0)try{this._t=!1;let t=this.D.pop();if(this.Rt.push(t),this.D.length===0)this.t.getObjects().forEach(e=>{e.selectable&&this.t.remove(e)});else{let e=JSON.parse(this.D[this.D.length-1]);this.t.getObjects().forEach(i=>{i.selectable&&this.t.remove(i)}),e.forEach(i=>{fabric.util.enlivenObjects([i],s=>{s.forEach(o=>{this.t.add(o)}),this.t.renderAll()})})}this._t=!0,this.Ut(),this.ye("Undo Completed")}catch(t){this._t=!0,this.Ut()}}ee(){if(this.Rt.length!==0)try{this._t=!1;let t=JSON.parse(this.Rt.pop());this.D.push(JSON.stringify(t)),this.t.getObjects().forEach(e=>{e.selectable&&this.t.remove(e)}),t.forEach(e=>{fabric.util.enlivenObjects([e],i=>{i.forEach(s=>{this.t.add(s)}),this.t.renderAll()})}),this._t=!0,this.Ut(),this.ye("Redo Completed")}catch(t){this._t=!0,this.Ut()}}ye(t){}Ut(){if(this.Lt){let t=this.D.length>0;this.Lt.classList.toggle("disabled",!t),this.Lt.title=t?"Undo (Ctrl+Z)":"Nothing to undo"}if(this.At){let t=this.Rt.length>0;this.At.classList.toggle("disabled",!t),this.At.title=t?"Redo (Ctrl+Shift+Z)":"Nothing to redo"}}destroy(){this.t.off("object:modified",this.nt),this.t.off("object:added",this.nt),document.removeEventListener("keydown",this.gt),this.Lt&&this.Lt.removeEventListener("click",this.te),this.At&&this.At.removeEventListener("click",this.ee),this.D=[],this.Rt=[],this.ye("Manager Destroyed")}};var g,A=class{constructor(t={}){D(this,g,void 0);this.destroy(),this.i=new b,this.overlay=t.overlay,this.ie=t.imageData,this.Ye=t.elementId||"FlagBugIO__screenshot",this.co(),this.uo=document.querySelector("#canvas-controls-wrapper"),this.$i=document.querySelector("#canvas-utility-wrapper")}co(){let t='<div class="FlagBugIO"><div class="__a__"><div class="__b__"><div class="__c__ loading"><ul class="__d__"id="canvas-controls-wrapper"></ul><ul class="__d__"id="canvas-utility-wrapper"></ul></div><div class="__i__ loading"><div class="__j__"><div class="ring __k__"></div><div class="ring __k__"></div><div class="ring __l__"></div></div><div id="FlagBugIO__screenshot"></div></div></div><div class="__m__"></div></div></div>',e=document.createElement("div");e.id="FlagBugIO__screenshot",e.innerHTML=t,document.body.appendChild(e)}Mi(t){let e=t||this.Ye,i=document.getElementById(e);if(!i)return null;i.classList.add("fade-in-el");let s=document.createElement("canvas");s.id=`${e}_canvas`;try{ft(`#${this.Ye}`).append(s)}catch(o){return null}try{st(this,g,new fabric.Canvas(s.id,{selection:!1,preserveObjectStacking:!0}))}catch(o){return null}return m(this,g).setWidth(s.clientWidth||600),m(this,g).setHeight(300),document.querySelectorAll(".loading").forEach(o=>o.classList.remove("loading")),m(this,g)}async addImage(t){return t?(this.Mi(),this.ie=t,await gt(m(this,g),this.ie,this.ie.width,this.ie.height)?(this.overlay&&this.addCanvasOverlay(),!0):(window.w.create({title:"Error",description:"Failed to load image. Please try again.",type:"error"}),!1)):void 0}addCanvasOverlay(t=".canvas-container"){let e=this.i.create({id:"f-overlay-inner"});this.i.style(e,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%","z-index":"10000","background-color":"rgba(0, 0, 0, 0.5)",cursor:"pointer"}),t=this.i.getOne(t),e.addEventListener("click",i=>{let s=t.getBoundingClientRect(),o=s.left,r=s.top,n={mouseX:i.clientX-o+window.Ti.left,mouseY:i.clientY-r+window.Ti.top,scrollX:window.T.scrollX,scrollY:window.T.scrollY};window.T=n,this.i.remove(t,e),this.fo()}),this.i.append(t,e)}fo(){this.at=new O(m(this,g)),this.ve=[{id:"canvas-arrow",control:"arrow",class:P,key:"A"},{id:"canvas-rectangle",control:"rectangle",class:j,key:"R"},{id:"canvas-circle",control:"circle",class:I,key:"O"},{id:"canvas-colorpicker",control:"color",class:B,key:"K"},{id:"canvas-uploadimage",control:"imageAdd",class:R,key:"U"},{id:"canvas-pencil",control:"pencil",class:N,key:"P"},{id:"canvas-mask",control:"mask",class:q,key:"M"},{id:"canvas-emoji",control:"emoji",class:F,key:"E"},{id:"canvas-text",control:"text",class:pt,key:"T"}],this.go=[{id:"undoButton",control:"undo",key:"Z"},{id:"redoButton",control:"redo",key:"Y"}],this.go.forEach(i=>{if(!document.querySelector(`#${i.id}`)){let o=this.i.createTree({tag:"li",className:"__e__ __icon",children:[{tag:"div",id:i.id,className:"__f__",inner:i.key,isDraggable:!0}]});this.$i.appendChild(o)}});let t=document.querySelector("#undoButton"),e=document.querySelector("#redoButton");this.He=new U(m(this,g),t,e),this.be=[{id:"canvas-download",action:this.po.bind(this),key:"S",useModifier:!0},{id:"canvas-copy",action:this.mo.bind(this),key:"C",useModifier:!0}],this.ve.forEach(i=>{let s=this.i.createTree({tag:"li",className:"__e__ __icon",children:[{tag:"div",id:i.id,className:"__f__",inner:i.key,isDraggable:!0}]});this.uo.appendChild(s)}),this.be.forEach(i=>{let s=this.i.createTree({tag:"li",className:"__e__ __icon",children:[{tag:"div",id:i.id,className:"__f__",inner:i.key,isDraggable:!0}]});this.$i.appendChild(s)}),this.ve.forEach(i=>{let s=document.querySelector(`#${i.id}`);s&&(this.at.ro(i.control,new i.class(m(this,g),s)),s.addEventListener("click",()=>{this.at.ki(i.control)}))}),this.be.forEach(i=>{let s=document.querySelector(`#${i.id}`);s&&s.addEventListener("click",()=>{i.action()})}),this.wo(),this.yo()}po(){if(!m(this,g))return;let t=m(this,g).toDataURL("image/png"),e=document.createElement("a");e.download="screenshot.png",e.href=t,e.click()}async mo(){if(m(this,g))try{let t=m(this,g).toDataURL("image/png"),e=await(await fetch(t)).blob();await navigator.clipboard.write([new ClipboardItem({"image/png":e})])}catch(t){}}async kr(){if(!m(this,g))return;let t=m(this,g).toDataURL("image/jpeg",.7);return await(await fetch(t)).blob()}wo(){document.addEventListener("keydown",t=>{if(!t.target.matches("input, textarea")&&(t.key==="Delete"||t.key==="Backspace")){let e=m(this,g).getActiveObject();e&&(e.type==="activeSelection"?e.forEachObject(i=>{m(this,g).remove(i)}):m(this,g).remove(e),m(this,g).discardActiveObject(),m(this,g).requestRenderAll())}})}yo(){this.Xe={},this.ve.forEach(t=>{t.key&&(this.Xe[t.key.toLowerCase()]={type:"control",action:t.control,useModifier:!1})}),this.be.forEach(t=>{t.key&&(this.Xe[t.key.toLowerCase()]={type:"utility",action:t.id,useModifier:t.useModifier||!1})}),document.addEventListener("keydown",t=>{if(t.target.matches("input, textarea"))return;let e=t.key.toLowerCase(),i=t.ctrlKey||t.metaKey,s=this.Xe[e];if(s&&(s.useModifier&&i||!s.useModifier&&!i)){if(t.preventDefault(),s.type==="control"){this.at.ki(s.action);let o=this.ve.find(r=>r.control===s.action);if(o){let r=document.querySelector(`#${o.id}`);if(r){let n=this.at.b&&this.at.b===this.at.J.get(s.action);r.classList.toggle("active",n)}}}else if(s.type==="utility"){let o=this.be.find(r=>r.id===s.action);o&&o.action&&o.action()}}})}vo(){return m(this,g)}Vt(){m(this,g).renderAll()}initialize(t){return this.Mi(t)}getCanvas(){return this.vo()}render(){return this.Vt()}destroy(){m(this,g)&&(m(this,g).clear(),m(this,g).dispose(),st(this,g,null)),this.at&&(this.at.destroy(),this.at=null),this.He&&(this.He.destroy(),this.He=null);let t=document.getElementById(this.Ye);t&&t.remove();let e=document.querySelector(".FlagBugIO");e&&e.remove(),this.ie=null}};g=new WeakMap;var Y=class{constructor(t={}){v(this,"Pi",t=>{t.data&&t.data.source==="flagbugapp"&&t.data.action==="screenshotCaptured"&&(this.Ii(),window.Ti=t.data.rect,window.T={scrollX:window.scrollX,scrollY:window.scrollY},this.ji(t.data.imageData))});this.n=t.n,this.B=t.B,this.C=t.C,this.o=!0,this.$t=null,this.bo()}async Oi(t){if(document.body.classList.add("fg_overlay-active"),this.C.hasExtension&&t==="screenshot"){let s=window.scrollX,o=window.scrollY;window.T={mouseX:0,mouseY:0,scrollX:s,scrollY:o},window.ko.Co(),window.removeEventListener("message",this.Pi),window.addEventListener("message",this.Pi);return}document.body.insertAdjacentHTML("beforeend",'<div class="fg-overlay"></div>'),document.querySelector(".fg-overlay").addEventListener("click",s=>{if(s.preventDefault(),!this.C.hasExtension&&t==="screenshot"){let r=new A({overlay:!1});this.We("screenshot"),window.kt.bs({payload:{href:"https://2cube.studio/",width:window.innerWidth,height:window.innerHeight,scrollX:window.scrollX,scrollY:window.scrollY,pixelRatio:1}}).then(n=>{n&&r.addImage(n)})}let o={mouseX:s.clientX,mouseY:s.clientY,scrollX:window.scrollX,scrollY:window.scrollY};window.T=o,t==="comment"?this.We():t==="screenshot"&&this.C.hasExtension?this.ji():t==="explore"&&this.Eo(),this.Ii()})}Ii(){let t=document.querySelector(".fg-overlay");document.body.classList.remove("fg_overlay-active"),t&&t.remove()}So(){return'<div class="fg-control-button"type="comment">C</div>'}xo(){return'<div class="fg-control-button"type="screenshot">S</div>'}Do(){return'<div class="fg-control-button"type="explore">E</div>'}_o(t){let e=!!t._comment,i=!!t._screenshot,s=!!t._explore;return`<div class="fg-control-container"><div class="fg-control-button"type="picker">P</div><div class="fg-control-buttons">${e?this.So():""} ${i?this.xo():""} ${s?this.Do():""} </div></div>`}bo(){let t={_comment:{key:"c"},_screenshot:{key:"s"},_explore:{key:"e"}},e=this._o(t),i=window.p.E,s=this.C.hasExtension;this.o,this.o,!s&&!i?window.kt.ri({domain:window.location.hostname}).then(o=>{o.total>0&&(document.body.insertAdjacentHTML("beforeend",e),this.Ve(t))}):i&&!s&&(document.body.insertAdjacentHTML("beforeend",e),this.Ve(t)),window.p.E&&s&&(document.body.insertAdjacentHTML("beforeend",e),this.Ve(t))}Ve(t){Object.keys(t).forEach(e=>{if(!t[e])return;let i=e.replace("_",""),s=document.querySelector(`.fg-control-button[type="${e.replace("_","")}"]`);s&&(s.addEventListener("click",()=>{this.Ni(i)}),document.addEventListener("keydown",o=>{let r=!o.ctrlKey&&!o.metaKey&&!o.altKey&&!o.shiftKey;o.target.matches('input, textarea, [contenteditable="true"]')||r&&o.key===t[e].key&&this.Ni(i)}))})}Ni(t){if(!window.p.c){window.userLogin();return}if(this.$t!==null){this.o,window.w.create({title:"Error",description:"Please complete the current task before creating a new one.",type:"error"});return}this.$t=t,t!=="explore"&&this.Oi(t)}qi(){this.$t=null,window.T=null;let t=document.querySelector(".fg-create-task");t&&t.remove();let e=document.querySelector("#FlagBugIO__screenshot");e&&e.remove()}We(t="comment"){this.B.Zs({title:"New Design Homepage Development",description:"This Create a responsive homepage layout with navigation.",due_date:"2025-04-05",assigned_to:"6",priority:"low",status:"open"},t),this.B.form("onFormCreated",e=>{this.o,this.setFormPosition(e.form,window.T)}),this.B.form("onFormCanceled",e=>{this.$t=null,window.T=null}),this.B.form("onFormDone",e=>{this.o,this.$t=null,window.T=null,t==="screenshot"&&document.querySelector("#FlagBugIO__screenshot").remove()}),this.B.form("onFormSubmitted",e=>{this.o}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.qi()})}setFormPosition(t,e=null){if(!t)return;if(t.setAttribute("type",this.$t),this.$t==="screenshot"||e===null){t.classList.add("view");return}let i=e.mouseX+e.scrollX,s=e.mouseY+e.scrollY,o=t.offsetWidth,r=t.offsetHeight,n=window.innerWidth,l=window.innerHeight,h,c;i+o+10<=n?h=i:(h=i-o,h<10&&(h=10)),s+r+10<=l?c=s:(c=s-r,c<10&&(c=10)),t.style.position="absolute",t.style.left=h+"px",t.style.top=c+"px",t.classList.add("view")}ji(t=null){this.o;let e=this.C.hasExtension;new A({overlay:e}).addImage(t),this.We("screenshot")}Eo(){this.o}};var x=class{constructor({body:t,trigger:e,storageKey:i,type:s="free",initialPosition:o={x:0,y:0},allowDragOn:r=null,permissions:n="edit",offset:l={top:0,bottom:0,left:0,right:0},dragDelay:h=250}){v(this,"Yi",t=>{this.se&&(t.stopPropagation(),t.preventDefault(),this.se=!1)});v(this,"q",t=>{if(this.Ri&&!t.target.closest(this.Ri))return;this.se=!1;let e=this.f.getBoundingClientRect();this.Ui.x=t.clientX-e.left,this.Ui.y=t.clientY-e.top,this.Mo=this.R.x||0,this.To=this.R.y||0,this.Oo=t.clientX,this.Po=t.clientY,this.i.addClass(this.f,"drag-pending"),this.vt&&clearTimeout(this.vt),this.vt=setTimeout(()=>{t.preventDefault(),this.ke=!0,this.se=!0,this.Hi=this.f.style.transition,this.f.style.transition="none",this.i.removeClass(this.f,"drag-pending"),this.i.addClass(this.f,"drag-start"),this.i.addClass(this.f,"dragging"),this.i.addClass(this.yt,"dragging"),this.i.addClass(document.body,"dragging"),this.Ce("dragStart",{element:this.f,position:p({},this.R)})},this.Ao)});v(this,"Dt",t=>{if(!this.ke)return;this.se=!0;let e=t.clientX-this.Oo,i=t.clientY-this.Po,s=this.Mo+e,o=this.To+i,r=this.f.getBoundingClientRect(),n=window.innerWidth,l=window.innerHeight,h=this.Yt.left;s<h&&(s=h);let c=n-r.width-this.Yt.right;s>c&&(s=c);let d=this.Yt.top;o<d&&(o=d);let f=l-r.height-this.Yt.bottom;o>f&&(o=f),this.f.style.transform=`translate(${s}px, ${o}px)`,this.R={x:s,y:o},this.Ce("dragMove",{element:this.f,position:{x:s,y:o},delta:{x:e,y:i}})});v(this,"F",()=>{this.vt&&(clearTimeout(this.vt),this.vt=null),this.i.removeClass(this.f,"drag-pending"),this.ke&&(this.ke=!1,this.f.style.transition=this.Hi||"",this.A==="snap"&&this.jo(),this.i.removeClass(this.f,"drag-start"),this.i.removeClass(this.f,"dragging"),this.i.removeClass(this.yt,"dragging"),this.i.removeClass(document.body,"dragging"),this.Fi&&this.R&&this.Lo.set(this.Fi,this.R),this.Ce("dragEnd",{element:this.f,position:p({},this.R),type:this.A}))});this.i=new b,this.Lo=[],this.f=this.i.getOne(t),this.yt=this.i.getOne(e,this.f)||this.i.getOne(e),this.Fi=i,this.A=s,this.Bi=o,this.Ri=r,this.Yt=l,this.Ao=h,this.ht=n,this.Ui={x:0,y:0},this.ke=!1,this.se=!1,this.vt=null,this.R={x:0,y:0},this.j={dragStart:[],dragMove:[],dragEnd:[],snap:[]},this.f&&this.yt&&(this.A!=="fixed"&&this.$o(),this.Je())}$o(){this.i.setAttr(this.f,"data-drag-body","true"),this.i.setAttr(this.yt,"data-draggable","true"),this.ht!=="view"&&(this.yt.addEventListener("mousedown",this.q),document.addEventListener("mouseup",this.F),document.addEventListener("mousemove",this.Dt),this.yt.addEventListener("click",this.Yi,!0))}on(t,e){return this.j[t]?(this.j[t].push(e),!0):!1}off(t,e){return this.j[t]?(e?this.j[t]=this.j[t].filter(i=>i!==e):this.j[t]=[],!0):!1}Ce(t,e){this.j[t]&&this.j[t].forEach(i=>{i(e)})}jo(){let t=window.innerWidth,e=this.f.getBoundingClientRect(),i=this.R.x+e.width/2,s=t/2,o,r;i<s?(o=this.Yt.left,r="left"):(o=t-e.width-this.Yt.right,r="right"),this.f.style.transition="transform 0.2s ease",this.f.style.transform=`translate(${o}px, ${this.R.y}px)`,this.R.x=o,this.i.setAttr(this.f,"data-snap",r),setTimeout(()=>{this.f.style.transition=this.Hi||""},300),this.Ce("snap",{element:this.f,position:{x:o,y:this.R.y},snapPosition:r})}Je(){let t=this.Bi;if(t){let{x:e,y:i}=t;if(this.f.style.transform=`translate(${e}px, ${i}px)`,this.R={x:e,y:i},this.A==="snap"){let s=window.innerWidth,o=this.f.getBoundingClientRect(),r=e+o.width/2,n=s/2,l=r<n?"left":"right";this.i.setAttr(this.f,"data-snap",l)}}}Io(t){if(t){let{x:e,y:i}=t;this.Bi={x:e,y:i},this.Je()}else return}destroy(){this.vt&&clearTimeout(this.vt),this.yt.removeEventListener("mousedown",this.q),document.removeEventListener("mouseup",this.F),document.removeEventListener("mousemove",this.Dt),this.yt.removeEventListener("click",this.Yi,!0)}};window.Dragable=x;var H=class{constructor(t={}){v(this,"groupBy",(t,e,i=!0)=>{let s=t.reduce((o,r)=>{let n=r[e];return o[n]||(o[n]=[]),o[n].push(r),o},{});return i?{keys:Object.keys(s),data:s}:s});this.i=new b,this.o=!1,this.v=window.v,this.k=this.v.k,this.n=window.p,this.Ft=window.kt,this.h=this.n.h,this.c=this.n.c,this.indexCount=0,this.ze=this.groupBy(this.h,"isSamePage",!1),this.No=this.h.filter(e=>e.isSamePage),this.qo=this.h.filter(e=>!e.isSamePage),this.oe={},this.re=null,this.o,this.Ge=this.v.Ss(),this.Fo=["page","priority","status"],this.priority=this.Ge.query.priority||null,this.status=this.Ge.query.status||null,this.page=this.Ge.query.page||null,this.Ee(!0,!0)}set(t){this.v.Cr(t,push=!0)}remove(){this.v.De(push=!0)}get(){return this.k}on(t,e){this.oe[t]||(this.oe[t]=[]),this.oe[t].push(e)}Ke(t,e){this.oe[t]&&this.oe[t].forEach(i=>i(e))}Bo(t){let e=window.confirm(`This task is from another page:

${t.href}

Do you want to navigate there?`),i=new QueryHelper(t.href);this.Fo.forEach(s=>{this[s]?i.X(s,this[s]):i.Et(s)}),i.X("mkr",t.id),t.href=i.st(),this.o,e&&(window.location.href=t.href)}Xi(t){var s;if(this.c.role==="guest")return;let e=String(t),i=((s=this.re)==null?void 0:s.getAttribute("mkr-id"))||null;if(i===e){this.Mt=i,this.Se(t);return}if(i){this.Mt=i,this.Se(i);let o=this.i.get(`[mkr-id="${i}"]`)[0]}this.Mt=i,this.Wi(t)}Wi(t){let e=document.querySelectorAll(`[mkr-id="${t}"]`);if(!e.length)return;e.forEach(r=>r.classList.add("active")),this.re=e[0];let i=parseInt(t),s=this.Mt?parseInt(this.Mt):null,o=this.i.get(`.explorer-task[mkr-id="${t}"]`)[0];o&&o.scrollIntoView({behavior:"smooth",block:"center"}),this.o,this.Ke("click",{taskId:i,previousId:s,active:!0,element:e[0]})}Se(t){var o;let e=document.querySelectorAll(`[mkr-id="${t}"]`);if(!e.length)return;e.forEach(r=>r.classList.remove("active"));let i=parseInt(t),s=this.Mt?parseInt(this.Mt):null;this.o,this.Ke("click",{taskId:i,previousId:s,active:!1,element:e[0]}),((o=this.re)==null?void 0:o.getAttribute("mkr-id"))===String(t)&&(this.re=null)}Vi(t){this.indexCount++;let e=this.i.create({id:"marker",className:"mkr mkrClick f_ marker-floating",inner:this.indexCount,attributes:{"mkr-id":t.id,priority:t.priority,status:t.status,tabindex:this.indexCount}}),i={x:t.screeninfo.mouseX+t.screeninfo.scrollX,y:t.screeninfo.mouseY+t.screeninfo.scrollY};this.i.style(e,{position:"absolute",transform:`translate(${i.x}px, ${i.y}px)`}),e.addEventListener("click",r=>{this.Xi(t.id)}),this.i.append(document.body,e);let{isSameUser:s}=this.n.getUserPermissions(t),{role:o}=this.n.getUserPermissions();return this.Tt||(this.Tt={}),this.Tt[t.id]&&this.Tt[t.id].destroy(),this.Tt[t.id]=new x({body:`.mkr[mkr-id="${t.id}"]`,trigger:`.mkr[mkr-id="${t.id}"]`,storageKey:null,type:"free",initialPosition:{x:t.screeninfo.mouseX,y:t.screeninfo.mouseY}}),this.Tt[t.id].on("dragEnd",async r=>{this.o;let n={id:t.id,mouseX:r.position.x,mouseY:r.position.y};if(this.o,s||o==="admin"){let l=await this.Ft.vs({payload:n});this.o}else window.w.create({title:"Error",description:"You don't have permission to move this task.",type:"error"}),this.Tt[t.id].Je()}),e}Ze(t){let e=this.rt(t.created_at,!1),i=this.i.create({tag:"div",className:"explorer-task mkrClick",attributes:{"mkr-id":t.id}}),s=t.description.length>85?t.description.slice(0,85)+"...":t.description,o=` <div class="task-meta f_row"><div class="task-time f_text_primary"><div class="f_badge ${t.priority}"></div>${e}</div><div class="task-tags"><div class="f_text_badge_text f_text_accent">${t.page||"index"}</div><div class="f_text_badge_text f_text_accent ${t.status}">${t.status}</div></div></div><div class="task-title f_text_primary">${t.title}</div><div class="task-desc f_text_primary">${s}</div>`;return i.appendChild(this.i.Fragment(o)),i.addEventListener("click",r=>{t.isSamePage?this.Xi(t.id):this.c.role!=="guest"&&this.Bo(t)}),this.o,this.Ji&&this.i.append(this.Ji[0],i),i}rt(t,e=!0){let i=t instanceof Date?t:new Date(t),s=new Date;if(!e){let d=["January","February","March","April","May","June","July","August","September","October","November","December"][i.getMonth()],f=i.getDate(),u=i.getHours(),k=i.getMinutes().toString().padStart(2,"0"),V=u>=12?"PM":"AM";return u=u%12,u=u||12,`${d} ${f}, ${u}:${k} ${V}`}let o=s-i,r=Math.floor(o/1e3),n=Math.floor(r/60),l=Math.floor(n/60),h=Math.floor(l/24);return r<30?"few seconds ago":r<60?"30s ago":n<60?`${n}m ago`:l<24?`${l}h ago`:`${h}d ago`}rs(t){this.o,this.Ze(t),this.Vi(t)}Er(t,e=!1){this.h=this.n.h;let i=this.h.find(o=>o.id===t),s=this.i.get(`.explorer-task[mkr-id="${t}"]`)[0];if(s&&!e){let o=this.Ze(i);s.parentNode.replaceChild(o,s)}e&&this.i.get(`[mkr-id="${t}"]`).forEach(o=>o.remove())}Ro(){this.indexCount=0,this.i.get(".marker-floating[mkr-id]").forEach(t=>{this.indexCount++,t.innerHTML=this.indexCount,t.setAttribute("tabindex",this.indexCount)})}bi(t){this.i.get(`[mkr-id="${t}"]`).forEach(e=>e.remove()),this.indexCount--,this.Ro()}Uo(){return this.i.create({id:"explorer",className:"f_box_shadow f_bg_accent f_border_accent bug-explorer",inner:' <div class="f-gd f-px--n f-py--m"><div class="f_bg_gradient f_space"><div class="f_title f_text_primary f_text_accent f_text_white explorer-header">Bug Explorer</div></div></div><div class="filter-by f_margin_sm f_row f_full_width f_space_x"><div class="priority f_col f_input arrow_down small_arrow f_half_width f_border f_radius"></div><div class="status f_col f_input arrow_down small_arrow f_half_width f_border f_radius"></div><div class="page-wise f_col f_input arrow_down small_arrow f_full_width f_border f_radius"></div></div><div class="taskList"></div>'})}Ee(t=!0,e=!1){this.h=this.n.h,this.ze=this.groupBy(this.h,"isSamePage",!1),this.No=this.h.filter(i=>i.isSamePage),this.qo=this.h.filter(i=>!i.isSamePage),t?this.i.get("[mkr-id]").forEach(i=>i.remove()):this.i.get(".explorer-task").forEach(i=>i.remove()),Object.keys(this.ze).forEach(i=>{this.ze[i].forEach((s,o)=>{let r=(!this.priority||s.priority===this.priority)&&(!this.status||s.status===this.status)&&(!this.page||s.page===this.page);i==="true"&&r&&t&&this.Vi(s),r&&!e&&this.Ze(s)})})}Yo(){let t=this.Uo();this.i.append(document.body,t);let e=this.i.get(".taskList",t);this.Qe(t,".priority",this.n.priority,"Priority","priority",this.priority),this.Qe(t,".status",this.n.status,"Status","status",this.status);let i=this.groupBy(this.h,"page").keys;return this.Qe(t,".page-wise",i,"Page","page",this.page),new x({body:"#explorer",trigger:".f-py--m",type:"snap",initialPosition:{x:70,y:10},offset:{top:10,bottom:10,left:70,right:70}}),e}Sr(){let t=document.querySelector("#explorer");t?t.remove():(this.Ji=this.Yo(),this.Ee(!1))}Qe(t,e,i,s,o){new DropdownSelect({element:t.querySelector(e),data:i,type:"single",style:"picker",placeholder:s,isClearable:!0,prefetch:o}).l.addEventListener("change",n=>{this[o]=n.detail[0]||null,this.Ee(!0),this.re=null,this.Mt=null,this.Ke("change",n.detail)})}};var X=class a{constructor(t={}){this.defaults={content:"",placement:"top",trigger:"hover",delay:{show:300,hide:200},animation:"fade",offset:8,theme:"dark",maxWidth:300,boundary:"viewport",flip:!0,arrow:!0,interactive:!1,closeOnClickOutside:!0,hideOnScroll:!0,sticky:!1,once:!1,customClass:"",html:!1,template:'<div class="flagbug-tooltip fg-anim" role="tooltip"><div class="flagbug-tooltip-arrow"></div><div class="flagbug-tooltip-content"></div></div>',selector:null,dataAttributes:!0,globalConfig:{}},this.config=p(p({},this.defaults),t),this.d=null,this.bt=null,this.xe=null,this.ne=null,this.Z=!1,this.zi=!1,this.Ue()}Ue(){Object.keys(this.config.globalConfig).length>0&&(this.config=p(p({},this.config),this.config.globalConfig)),this.config.selector?this.Ho():this.config.dataAttributes&&this.Xo(),this.config.hideOnScroll&&window.addEventListener("scroll",this.Gi.bind(this),{passive:!0})}Ho(){let t=document.querySelectorAll(this.config.selector);t.length&&t.forEach(e=>{this.ti(e)})}Xo(){let t=document.querySelectorAll("[data-tooltip]");t.length&&t.forEach(e=>{let i={content:e.getAttribute("data-tooltip"),placement:e.getAttribute("data-placement")||this.config.placement,trigger:e.getAttribute("data-trigger")||this.config.trigger,theme:e.getAttribute("data-theme")||this.config.theme,animation:e.getAttribute("data-animation")||this.config.animation};this.ti(e,i)})}ti(t,e={}){let i=p(p({},this.config),e);t._=i,i.trigger==="hover"?(t.addEventListener("mouseenter",this.Wo.bind(this,t)),t.addEventListener("mouseleave",this.Vo.bind(this,t)),i.sticky&&t.addEventListener("mousemove",this.Zt.bind(this,t))):i.trigger==="click"&&(t.addEventListener("click",this.Jo.bind(this,t)),i.closeOnClickOutside&&document.addEventListener("click",this.zo.bind(this))),t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),t.addEventListener("keydown",this.gt.bind(this,t)),t.setAttribute("aria-describedby",`tooltip-${this.Ki()}`)}Wo(t,e){this.bt=t,this.Go(t)}Vo(t,e){if(t._.interactive&&this.d){let i=this.d.getBoundingClientRect();if(e.clientX>=i.left&&e.clientX<=i.right&&e.clientY>=i.top&&e.clientY<=i.bottom)return}this.Zi()}Zt(t,e){if(t._.sticky&&this.Z){let i=e.clientX,s=e.clientY;this.Ko(i,s)}}Jo(t,e){this.bt=t,this.Z?this.ae():this.ei(t)}zo(t){if(!this.Z||!this.d)return;let e=this.d.contains(t.target),i=this.bt&&this.bt.contains(t.target);!e&&!i&&this.ae()}gt(t,e){(e.key==="Enter"||e.key===" ")&&!this.Z&&(e.preventDefault(),this.ei(t)),e.key==="Escape"&&this.Z&&(e.preventDefault(),this.ae())}Gi(){this.Z&&this.config.hideOnScroll&&this.ae()}Go(t){if(clearTimeout(this.ne),clearTimeout(this.xe),t._.once&&this.zi)return;let e=typeof t._.delay=="object"?t._.delay.show:t._.delay;this.xe=setTimeout(()=>{this.ei(t)},e)}Zi(){clearTimeout(this.xe),clearTimeout(this.ne);let t=typeof this.bt._.delay=="object"?this.bt._.delay.hide:this.bt._.delay;this.ne=setTimeout(()=>{this.ae()},t)}ei(t){if(this.Z)return;let e=t._;this.d||this.Zo(t),this.setContent(t),this.Qi(t),this.d.classList.add("view"),this.Z=!0,this.zi=!0,e.interactive&&(this.d.addEventListener("mouseenter",()=>{clearTimeout(this.ne)}),this.d.addEventListener("mouseleave",()=>{this.Zi()}))}ae(){!this.Z||!this.d||(this.d.classList.remove("view"),this.Z=!1,setTimeout(()=>{this.d&&this.d.parentNode&&(this.d.parentNode.removeChild(this.d),this.d=null)},300))}Zo(t){let e=t._,i=document.createElement("div");i.innerHTML=e.template.trim(),this.d=i.firstChild;let s=`tooltip-${this.Ki()}`;if(this.d.id=s,e.customClass&&this.d.classList.add(e.customClass),e.maxWidth&&(this.d.style.maxWidth=`${e.maxWidth}px`),!e.arrow){let o=this.d.querySelector(".flagbug-tooltip-arrow");o&&(o.style.display="none")}document.body.appendChild(this.d)}setContent(t){let e=t._,i=this.d.querySelector(".flagbug-tooltip-content");i&&(e.html?i.innerHTML=e.content:i.textContent=e.content)}Qi(t){let e=t._,i=t.getBoundingClientRect(),s=this.d.getBoundingClientRect(),o,r,n=e.placement;switch(e.placement){case"top":o=i.top-s.height-e.offset,r=i.left+i.width/2-s.width/2;break;case"bottom":o=i.bottom+e.offset,r=i.left+i.width/2-s.width/2;break;case"left":o=i.top+i.height/2-s.height/2,r=i.left-s.width-e.offset;break;case"right":o=i.top+i.height/2-s.height/2,r=i.right+e.offset;break;case"auto":let l=["top","right","bottom","left"],h=window.innerHeight,c=window.innerWidth,d={top:i.top,right:c-i.right,bottom:h-i.bottom,left:i.left},f=l.sort((u,k)=>d[k]-d[u])[0];return n=f,e.placement=f,this.Qi(t)}if(e.flip){let l=window.innerHeight,h=window.innerWidth;o<0?(o=i.bottom+e.offset,n="bottom"):o+s.height>l&&(o=i.top-s.height-e.offset,n="top"),r<0?(r=i.right+e.offset,n="right"):r+s.width>h&&(r=i.left-s.width-e.offset,n="left")}if(e.boundary==="viewport"){let l=window.innerHeight,h=window.innerWidth;o=Math.max(0,Math.min(o,l-s.height)),r=Math.max(0,Math.min(r,h-s.width)),o<=0?n="bottom":o+s.height>=l&&(n="top"),r<=0?n="right":r+s.width>=h&&(n="left")}this.d.style.top=`${o+window.scrollY}px`,this.d.style.left=`${r+window.scrollX}px`,this.d.setAttribute("data-placement",n)}Ko(t,e){if(!this.d)return;let i=this.bt._,s=this.d.getBoundingClientRect(),o=e+i.offset,r=t+i.offset;if(i.boundary==="viewport"){let n=window.innerHeight,l=window.innerWidth;o=Math.max(0,Math.min(o,n-s.height)),r=Math.max(0,Math.min(r,l-s.width))}this.d.style.top=`${o+window.scrollY}px`,this.d.style.left=`${r+window.scrollX}px`}Ki(){return Math.random().toString(36).substring(2,10)}static create(t,e={}){let i=new a(e);return i.ti(t,e),i}static initAll(t={}){return new a(C(p({},t),{dataAttributes:!0}))}destroy(){this.d&&this.d.parentNode&&this.d.parentNode.removeChild(this.d),this.config.hideOnScroll&&window.removeEventListener("scroll",this.Gi),clearTimeout(this.xe),clearTimeout(this.ne)}};var W=class{constructor(t={}){this.L=null,this.o=!1,this.n=t.n,this.Qo=window.location.hostname,this.n.c&&this.init()}init(){this.L=io("http://192.168.0.143:3030"),this.L.on("connect",()=>{this.L.emit("joinProject",{projectDomain:this.Qo,user_id:this.n.c.id,role:this.n.c.role,name:this.n.c.name})}),this.L.on("joinedProject",({socketId:t,room:e,rooms:i})=>{this.tr(),this.er(),this.ir(),this.sr(),this.or()})}or(){this.L.on("task:deleted",({id:t,triggeredBy:e})=>{window.p.Ot=t,window.k.bi(t),e.id===this.n.c.id?window.w.create({title:"Task Deleted!",description:`#${t} deleted.`,type:"success"}):window.w.create({title:`Hey! Task #${t} deleted by ${e.name}`,type:"info"})})}sr(){this.L.on("task:created",({task:t,triggeredBy:e})=>{window.p.ss=t;let i=`<a href="${t.href}?mkr=${t.id}"target="_blank">#${t.id}</a>`;e.id===this.n.c.id?window.w.create({title:"Task Created!",description:`#${t.id} ${t.title} created.`,type:"success"}):window.w.create({title:`Hey! New task ${i} by ${e.name}`,type:"info"})})}er(){this.L.on("task:updated",({task:t,triggeredBy:e})=>{window.p.et=t;let i=`<a href="${t.href}?mkr=${t.id}"target="_blank">#${t.id}</a>`;e.id===this.n.c.id?window.w.create({title:"Task Updated!",description:`#${t.id} ${t.title} updated.`,type:"success"}):window.w.create({title:`Hey! Task ${i} updated by ${e.name}`,type:"info"})})}ir(){this.L.on("task:status-updated",({task:t,triggeredBy:e})=>{window.p.et=t;let i=`<a href="${t.href}?mkr=${t.id}"target="_blank">#${t.id}</a>`,s=t.status==="completed";if(e.id===this.n.c.id)window.w.create({title:"Status Changed!",description:`#${t.id} ${t.title} status changed.`,type:"success"});else{let o=t.status==="completed",r=o?"success":"info",n={title:`${i} is marked as ${t.status}`,description:`Task updated by ${e.name}`,type:r};o&&(n.title=`${i} is completed`,n.description=`Task completed by ${e.name}`),window.w.create(p({},n))}})}tr(){this.L.on("task:position-updated",({task:t,triggeredBy:e})=>{window.p.et=t;let i=`<a href="${t.href}?mkr=${t.id}"target="_blank">#${t.id}</a>`,s={x:t.screeninfo.mouseX,y:t.screeninfo.mouseY};window.k.Tt[t.id].Io(s),e.id===this.n.c.id?window.w.create({title:"Position Changed!",description:`${i} ${t.title} position changed.`,type:"success"}):window.w.create({title:`${e.name} changed position of task ${i}`,type:"info"})})}};window.v=new E;window.oo=a=>new X(a);window.w={create:function(a){return new L().create(a)}};window.ko={Co:a=>{window.T=null,window.postMessage({source:"flagbugapp",action:"showButtons"},"*"),a&&a()}};window.addEventListener("message",a=>{a.data&&a.data.source==="flagbugapp"&&a.data.action==="iconClicked"&&window.userLogin("iconClicked")});var tt=class{constructor(t={}){if(window.ts=this,this.ns="1.0",this.o=!0,this.C=t,this.v=window.v,window.rt=this.rt.bind(this),this.es(),this.es("https://cdn.socket.io/4.7.2/socket.io.min.js"),window.userLogin=this.rr.bind(this),window.userLogout=this.nr.bind(this),this.n=new $(this),window.p=this.n,this.L=new W(this),window.L=this.L,this.Ft=new M(this),window.kt=this.Ft,this.B=new T(this),window.xr=this.B,this.J=new Y(this),window.J=this.J,this.k=new H(this),window.k=this.k,this.v.k&&this.n.c){let e=parseInt(this.v.k);this.B.et(e),this.k.Wi(e),this.is(e)}this.ar()}ar(){this.k.on("click",t=>{let{taskId:e,previousId:i,active:s,element:o}=t;s?(this.B.et(e),this.v.k=e):(this.J.qi(),this.v.De()),this.is(e)})}is(t){this.B.form("onFormCanceled",e=>{this.k.Se(t)}),this.B.form("onFormDone",e=>{this.k.Se(t),this.v.De()})}rt(t,e=!0){let i=t instanceof Date?t:new Date(t),s=new Date;if(!e){let d=["January","February","March","April","May","June","July","August","September","October","November","December"][i.getMonth()],f=i.getDate(),u=i.getHours(),k=i.getMinutes().toString().padStart(2,"0"),V=u>=12?"PM":"AM";return u=u%12,u=u||12,`${d} ${f}, ${u}:${k} ${V}`}let o=s-i,r=Math.floor(o/1e3),n=Math.floor(r/60),l=Math.floor(n/60),h=Math.floor(l/24);return r<30?"few seconds ago":r<60?"30s ago":n<60?`${n}m ago`:l<24?`${l}h ago`:`${h}d ago`}rr(t=null){if(window.p.c){this.o,this.J.Oi("screenshot");return}let e=prompt("Enter email","pratik@2cube.studio"),i=prompt("Enter password","pratik@123");if(!e||!i){this.o;return}e&&i&&window.kt.ms({payload:{email:e,password:i}}).then(s=>{s&&s.token&&(this.o,this.k.Ee(!0,!0))})}nr(){this.o,window.p.clearState()}es(t="https://cdn.jsdelivr.net/npm/fabric@4.6.0/dist/fabric.min.js"){return new Promise((e,i)=>{if(window.fabric){e(window.fabric);return}let s=document.createElement("script");s.src=t,s.async=!0,s.onload=()=>{e(window.fabric)},s.onerror=o=>{i(o)},document.head.appendChild(s)})}};function xt(a){let t=!1;function e(i){i.data==="FLAGBUG_EXTENSION_PONG"&&(t=!0,a(!0),window.removeEventListener("message",e))}window.addEventListener("message",e),setTimeout(()=>{window.postMessage("FLAGBUG_EXTENSION_PING","*")},10),setTimeout(()=>{t||(window.removeEventListener("message",e),a(!1))},200)}var wt=!0,yt="http://192.168.0.143:3030/api/v1/";wt||(yt="https://bugvault.2cube.studio/api/v1/");var mt={devMode:!1,endpoint:yt,apiLocal:wt};xt(function(a){a?window.ts||new tt(C(p({},mt),{hasExtension:!0})):window.ts||new tt(C(p({},mt),{hasExtension:!1}))});})();
